var trace=console?console.log.bind(console):function(){},LiteGUI={root_container:null,panels:{},undo_steps:[],modalbg_div:null,_modules_initialized:!1,mainmenu:null,modules:[],init:function(c){c=c||{};trace("Init lite");c.width&&c.height&&this.setWindowSize(c.width,c.height);this.root_container=$("#work-area")[0];this.modalbg_div=document.createElement("div");this.modalbg_div.className="litemodalbg";$(document.body).append(this.modalbg_div);c.menubar&&(this.mainmenu=new LiteGUI.Menubar("mainmenubar"),
$(c.menubar).append(this.mainmenu.root));c.gui_callback&&c.gui_callback();!1!=c.initModules&&this.initModules();$(document).bind("keydown",function(b){"input"!=b.target.nodeName.toLowerCase()&&"textarea"!=b.target.nodeName.toLowerCase()&&17!=b.keyCode&&((26==b.keyCode||90==b.keyCode&&(b.ctrlKey||b.metaKey)||122==b.charCode&&b.ctrlKey)&&LiteGUI.doUndo(),27==b.keyCode&&$(LiteGUI).trigger("escape"))});$("#wrap").hasClass("fullscreen")&&$(window).resize(function(b){LiteGUI.maximizeWindow()})},initModules:function(){for(var c in this.modules)this.modules[c].init_gui&&
this.modules[c].init_gui();for(c in this.modules)this.modules[c].init&&!this.modules[c]._initialized&&(this.modules[c].init(),this.modules[c]._initialized=!0);this._modules_initialized=!0},registerModule:function(c){this.modules.push(c);this._modules_initialized&&(c.init_gui&&c.init_gui(),c.init&&c.init());$(this).trigger("module_registered",c)},setWindowSize:function(c,b){if(c&&b)$("#wrap").css({width:c+"px",height:b+"px","box-shadow":"0 0 4px black"}).removeClass("fullscreen");else{if($("#wrap").hasClass("fullscreen"))return;
$("#wrap").addClass("fullscreen");$("#wrap").css({width:"100%",height:"100%","box-shadow":"0 0 0"})}$(LiteGUI).trigger("resized")},maximizeWindow:function(){this.setWindowSize()},max_undo_steps:100,min_time_between_undos:500,last_undo_time:0,addUndoStep:function(c){var b=(new Date).getTime();b-this.last_undo_time<this.min_time_between_undos||(this.undo_steps.push(c),this.last_undo_time=b,this.undo_steps.length>this.max_undo_steps&&this.undo_steps.shift())},doUndo:function(){if(this.undo_steps.length){var c=
this.undo_steps.pop();null!=c.callback&&c.callback(c.data);$(LiteGUI).trigger("undo",c)}},removeUndoSteps:function(){this.undo_steps=[]},addCSS:function(c){var b=document.createElement("style");b.type="text/css";b.innerHTML=c;document.getElementsByTagName("head")[0].appendChild(b)},requireCSS:function(c,b){for("string"==typeof c&&(c=[c]);c.length;){var a=document.createElement("link");a.rel="stylesheet";a.type="text/css";a.href=c.shift(1);a.media="all";document.getElementsByTagName("head")[0].appendChild(a);
0==c.length&&(a.onload=b)}},requireScript:function(c,b){function a(){var e=document.createElement("script");e.type="text/javascript";e.src=c.shift(1);e.onload=function(f){c.length?a():b&&b()};document.getElementsByTagName("head")[0].appendChild(e)}"string"==typeof c&&(c=[c]);a()},showModalBackground:function(c){c?$(LiteGUI.modalbg_div).show("fade"):$(LiteGUI.modalbg_div).hide("fade")},showMessage:function(c,b){b=b||{};b.title=b.title||"Attention";b.content=c;b.close="fade";var a=new LiteGUI.Dialog("info_message",
b);b.noclose||a.addButton("Close",{close:!0});a.makeModal("fade");return a},alert:function(c,b){b=b||{};b.className="alert";b.title="Alert";b.width=280;b.height=140;"string"==typeof c&&(c="<p>"+c+"</p>");return this.showMessage(c,b)},confirm:function(c,b,a,e){b=b||{};"function"==typeof b&&(e=a,a=b,b={});b.className="alert";b.title="Confirm";b.width=280;b.height=140;"string"==typeof c&&(c="<p>"+c+"</p>");b.noclose=!0;var f=this.showMessage(c+"<button class='yes-button' style='width:45%; margin-left: 10px'>Yes</button><button class='no-button' style='width:45%'>No</button>",
b);$(f.content).find(".yes-button").click(function(){a&&a();f.close()});$(f.content).find(".no-button").click(function(){e&&e();f.close()});return f},prompt:function(c,b,a,e){b=b||{};"function"==typeof b&&(e=a,a=b,b={});b.className="alert";b.title="Prompt";b.width=280;b.height=140+(b.textarea?40:0);"string"==typeof c&&(c="<p>"+c+"</p>");var f=b.value||"",g="<input type='text' value='"+f+"'/>";b.textarea&&(g="<textarea class='textfield' style='width:95%'>"+f+"</textarea>");b.noclose=!0;var d=this.showMessage(c+
("<p>"+g+"</p><button class='yes-button' style='width:45%; margin-left: 10px'>Accept</button><button class='no-button' style='width:45%'>Cancel</button>"),b);$(d.content).find(".yes-button").click(function(){var g=$(d.content).find(b.textarea?"textarea":"input").val();a&&a(g);d.close()});$(d.content).find(".no-button").click(function(){e&&e();d.close()});return d},getUrlVars:function(){for(var c=[],b,a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<a.length;e++)b=
a[e].split("="),c.push(b[0]),c[b[0]]=b[1];return c},getUrlVar:function(c){return LiteGUI.getUrlVars()[c]}};
(function(){function c(g,d){d=d||{};var a=document.createElement("div");a.className="litearea";g&&(a.id=g);this.root=a;this.root.litearea=this;this.options=d;var b=this;window.addEventListener("resize",function(d){b.resize(d)});this._computed_size=[$(this.root).width(),$(this.root).height()];a=document.createElement("div");d.content_id&&(a.id=d.content_id);a.className="liteareacontent";a.style.width="100%";a.style.height="100%";this.root.appendChild(a);this.content=a;this.split_direction="none";this.sections=
[];d.main&&$(LiteGUI).bind("resized",function(){b.resize()})}function b(g,d){d=d||{};this.width=d.width||200;this.height=d.height||100;this.content=d.content||"";var a=document.createElement("div");a.id=g;a.className="litepanel "+(d.className||"");a.data=this;var b="";d.title&&(b+="<div class='panel-header'>"+d.title+"</div><div class='buttons'>",d.minimize&&(b+="<button class='mini-button minimize-button'></button><button class='mini-button maximize-button' style='display:none'></button>"),d.hide&&
(b+="<button class='mini-button hide-button'></button>"),d.close&&(b+="<button class='mini-button close-button'></button>"),b+="</div>");b+="<div class='content'>"+this.content+"</div><div class='panel-footer'></div>";a.innerHTML=b;this.root=a;this.content=$(a).find(".content")[0];if(d.buttons)for(var c in d.buttons)this.addButton(d.buttons[c].name,d.buttons[c]);!0==d.scroll&&(this.content.style.overflow="auto");$(a).find(".close-button").bind("click",function(){a.data.close()});$(a).find(".minimize-button").bind("click",
function(){a.data.minimize()});$(a).find(".maximize-button").bind("click",function(){a.data.maximize()});$(a).find(".hide-button").bind("click",function(){a.data.hide()});this.makeDialog(d)}function a(g,d){d=d||{};var a=document.createElement("DIV");g&&(a.id=g);a.data=this;a.className="litetabs";this.root=a;this.current_tab=null;d.height&&(this.root.style.height="full"==d.height?"100%":d.height);a=document.createElement("UL");a.className="wtabcontainer";this.list=a;this.root.appendChild(this.list);
this.contents={};this.selected=null;this.onchange=d.callback;d.parent&&this.appendTo(d.parent)}function e(g){this.menu=[];this.panels=[];this.root=document.createElement("div");this.root.id=g;this.root.className="litemenubar";this.content=document.createElement("ul");this.root.appendChild(this.content);this.is_open=!1}function f(g,d,a){var b=document.createElement("div");this.root=b;b.id=g;b.className="litetree";this.tree=d;this.options=a=a||{allow_rename:!0,drag:!0};g=this.createTreeItem(d,a);g.className+=
" root_item";this.root.appendChild(g);this.root_item=g}c.prototype.getSection=function(g){g=g||0;return this.sections.length>g?this.sections[g]:null};c.prototype.resize=function(g){var d=[$(this.root).width(),$(this.root).height()];if(!g||!this._computed_size||d[0]!=this._computed_size[0]||d[1]!=this._computed_size[1])if(this.sections.length)for(var a in this.sections)this.sections[a].resize(g);else for(g=0;g<this.root.childNodes.length;g++)d=this.root.childNodes[g],d.litearea?d.litearea.resize():
$(d).trigger("resize")};c.prototype.split=function(g,d,a){function b(d){$(document).bind("mousemove",c);$(document).bind("mouseup",f);s[0]=d.pageX;s[1]=d.pageY;trace("Dragging");d.stopPropagation();d.preventDefault()}function c(d){"horizontal"==g?s[0]!=d.pageX&&r.moveSplit(s[0]-d.pageX):"vertical"==g&&s[1]!=d.pageY&&r.moveSplit(s[1]-d.pageY);s[0]=d.pageX;s[1]=d.pageY;d.stopPropagation();d.preventDefault();r.options.inmediateResize&&r.resize()}function f(d){trace("Stop Dragging");$(document).unbind("mousemove",
c);$(document).unbind("mouseup",f);r.resize()}g=g||"vertical";if(this.sections.length)throw"cannot split twice";var e=new LiteGUI.Area(null,{content_id:this.content.id});e.root.style.display="inline-block";var m=new LiteGUI.Area;m.root.style.display="inline-block";var l="",h=null,q=null;a&&(l=" - 5px",h=document.createElement("div"),h.className="litesplitbar "+g,$(h).bind("mousedown",b));d=d||["50%",null];"vertical"==g?(e.root.style.width="100%",m.root.style.width="100%",null==d[0]?(e.root.style.height=
"-moz-calc( 100% - "+d[1]+l+" )",e.root.style.height="-webkit-calc( 100% - "+d[1]+l+" )",e.root.style.height="calc( 100% - "+d[1]+l+" )",m.root.style.height=d[1],m.size=d[1],q=e):null==d[1]?(e.root.style.height=d[0],e.size=d[0],m.root.style.height="-moz-calc( 100% - "+d[0]+l+" )",m.root.style.height="-webkit-calc( 100% - "+d[0]+l+" )",m.root.style.height="calc( 100% - "+d[0]+l+" )",q=m):(e.root.style.height=d[0],e.size=d[0],m.root.style.height=d[1],m.size=d[1])):(e.root.style.height="100%",m.root.style.height=
"100%",null==d[0]?(e.root.style.width="-moz-calc( 100% - "+d[1]+l+" )",e.root.style.width="-webkit-calc( 100% - "+d[1]+l+" )",e.root.style.width="calc( 100% - "+d[1]+l+" )",m.root.style.width=d[1],m.size=d[1],q=e):null==d[1]?(e.root.style.width=d[0],e.size=d[0],m.root.style.width="-moz-calc( 100% - "+d[0]+l+" )",m.root.style.width="-webkit-calc( 100% - "+d[0]+l+" )",m.root.style.width="calc( 100% - "+d[0]+l+" )",q=m):(e.root.style.width=d[0],e.size=d[0],m.root.style.width=d[1],m.size=d[1]));e.root.removeChild(e.content);
e.root.appendChild(this.content);e.content=this.content;this.root.appendChild(e.root);h&&this.root.appendChild(h);this.root.appendChild(m.root);this.sections=[e,m];this.dynamic_section=q;this.direction=g;var r=this,s=[0,0]};c.prototype.moveSplit=function(g){if(this.sections){var d=this.sections[0],a=this.sections[1];"horizontal"==this.direction?this.dynamic_section==d?(g=$(a.root).width()+g+"px",d.root.style.width="-moz-calc( 100% - "+g+" - 2px )",d.root.style.width="-webkit-calc( 100% - "+g+" - 2px )",
d.root.style.width="calc( 100% - "+g+" - 2px )",a.root.style.width=g):(g=$(d.root).width()-g+"px",d.root.style.width=g,a.root.style.width="-moz-calc( 100% - "+g+" - 2px )",a.root.style.width="-webkit-calc( 100% - "+g+" - 2px )",a.root.style.width="calc( 100% - "+g+" - 2px )"):"vertical"==this.direction&&(this.dynamic_section==d?(g=$(a.root).height()+g+"px",d.root.style.height="-moz-calc( 100% - "+g+" - 2px )",d.root.style.height="-webkit-calc( 100% - "+g+" - 2px )",d.root.style.height="calc( 100% - "+
g+" - 2px )",a.root.style.height=g):(g=$(d.root).height()+g+"px",d.root.style.height=g,a.root.style.height="-moz-calc( 100% - "+g+" - 2px )",a.root.style.height="-webkit-calc( 100% - "+g+" - 2px )",a.root.style.height="calc( 100% - "+g+" - 2px )"))}};c.prototype.setAreaSize=function(a,d){var b=this.sections[1];b.root.style.width="-moz-calc( 100% - "+d+" - 2px )";b.root.style.width="-webkit-calc( 100% - "+d+" - 2px )";b.root.style.width="calc( 100% - "+d+" - 2px )"};c.prototype.merge=function(a){if(0==
this.sections.length)throw"not splitted";a=this.sections[a||0];this.root.appendChild(a.content);this.content=a.content;this.root.removeChild(this.sections[0].root);this.root.removeChild(this.sections[1].root);this.sections=[];this._computed_size=null;this.resize()};c.prototype.hideSection=function(a){if(0==this.sections.length)throw"not splitted";};LiteGUI.Area=c;LiteGUI.Split=function(a,d,b){b=b||{};var c=document.createElement("div");this.root=c;c.id=a;c.className="litesplit "+(b.vertical?"vsplit":
"hsplit");this.sections=[];for(var e in d)a=document.createElement("div"),a.className="split-section split"+e,"number"==typeof d[e]?b.vertical?a.style.height=d[e].toFixed(1)+"%":a.style.width=d[e].toFixed(1)+"%":"string"==typeof d[e]?b.vertical?a.style.height=d[e]:a.style.width=d[e]:(d[e].id&&(a.id=d[e].id),b.vertical?a.style.height="Number"==typeof d[e].height?d[e].height.toFixed(1)+"%":d[e].height:a.style.width="Number"==typeof d[e].width?d[e].width.toFixed(1)+"%":d[e].width),this.sections.push(a),
c.appendChild(a);b.parent&&(b.parent.root?b.parent.root.appendChild(c):b.parent.appendChild(c))};b.MINIMIZED_WIDTH=200;b.title_height="20px";b.prototype.makeDialog=function(a){a=a||{};var d=this.root;d.style.position="absolute";d.style.display="none";d.style.width=this.width+"px";this.height&&(d.style.height=this.height+"px");this.height&&$(d).find(".content").css({height:this.height-20});d.style.boxShadow="0 0 3px black";a.draggable&&(this.draggable=!0,$(d).draggable({handle:".panel-header"}));$(LiteGUI.root_container).append(this.root);
this.center()};b.prototype.dockTo=function(a,d){if(a){var b=this.root;b.style.top=0;b.style.left=0;b.style.boxShadow="0 0 0";if("full"==d)b.style.position="relative",b.style.width="100%",b.style.height="100%",this.content.style.width="100%",this.content.style.height="calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="-moz-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="-webkit-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.overflow="auto";
else if("left"==d||"right"==d)b.style.position="absolute",b.style.top=0,b.style[d]=0,b.style.width=this.width+"px",b.style.height="100%",this.content.style.height="-moz-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="-webkit-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.overflow="auto","right"==d&&(b.style.left="auto",b.style.right=0);else if("bottom"==d||"top"==d)b.style.width="100%",
b.style.height=this.height+"px","bottom"==d&&(b.style.bottom=0,b.style.top="auto");this.draggable&&$(b).draggable({disabled:!0});a.content?a.content.appendChild(b):"string"==typeof a?$(a).append(b):a.appendChild(b)}};b.prototype.addButton=function(a,d){var b=this,c=document.createElement("button");c.innerHTML=a;d.className&&(c.className=d.className);$(this.root).find(".panel-footer").append(c);$(c).bind("click",function(){d.callback&&d.callback();d.close&&b.close()});return c};b.prototype.close=function(a){$(this).trigger("closed");
a?$(this.root).hide("fade",null,function(){trace("Panel closed");$(this).remove()}):(trace("Panel closed"),$(this.root).remove())};b.minimized=[];b.prototype.minimize=function(){this.minimized||(this.minimized=!0,this.old_pos=$(this.root).position(),$(this.root).find(".content").hide(),$(this.root).draggable({disabled:!0}),$(this.root).find(".minimize-button").hide(),$(this.root).find(".maximize-button").show(),$(this.root).css({width:LiteGUI.Panel.MINIMIZED_WIDTH}),$(this).bind("closed",function(){LiteGUI.Panel.minimized.splice(LiteGUI.Panel.minimized.indexOf(this),
1);LiteGUI.Panel.arrangeMinimized()}),LiteGUI.Panel.minimized.push(this),LiteGUI.Panel.arrangeMinimized(),$(this).trigger("minimizing"))};b.arrangeMinimized=function(){var a=$(LiteGUI.root_container).height()-20,d;for(d in LiteGUI.Panel.minimized)$(LiteGUI.Panel.minimized[d].root).animate({left:LiteGUI.Panel.MINIMIZED_WIDTH*d,top:a+"px"},100)};b.prototype.maximize=function(){this.minimized&&(this.minimized=!1,$(this.root).find(".content").show(),$(this.root).draggable({disabled:!1}),$(this.root).animate({left:this.old_pos.left+
"px",top:this.old_pos.top+"px",width:this.width},100),$(this.root).find(".minimize-button").show(),$(this.root).find(".maximize-button").hide(),LiteGUI.Panel.minimized.splice(LiteGUI.Panel.minimized.indexOf(this),1),LiteGUI.Panel.arrangeMinimized(),$(this).trigger("maximizing"))};b.prototype.makeModal=function(){LiteGUI.showModalBackground(!0);$(LiteGUI.modalbg_div).append(this.root);$(this.root).draggable({disabled:!0});this.show();this.center();$(this).bind("closed",function(a){trace("closing");
LiteGUI.showModalBackground(!1)})};b.prototype.bringToFront=function(){var a=$(this.root).parent();a.detach(this.root);a.attach(this.root)};b.prototype.show=function(a,d){$(this.root).show(a,null,100,d);$(this).trigger("shown")};b.prototype.hide=function(a,d){$(this.root).hide(a,null,100,d);$(this).trigger("hidden")};b.prototype.setPosition=function(a,d){this.root.position="absolute";this.root.style.left=a+"px";this.root.style.top=d+"px"};b.prototype.center=function(){this.root.position="absolute";
this.root.style.left=Math.floor(0.5*($(this.root.parentNode).width()-$(this.root).width()))+"px";this.root.style.top=Math.floor(0.5*($(this.root.parentNode).height()-$(this.root).height()))+"px"};LiteGUI.Panel=b;LiteGUI.Dialog=b;a.tabs_height="30px";a.prototype.getCurrentTab=function(){return this.current_tab};a.prototype.appendTo=function(a,d){d?$(a).prepend(this.root):$(a).append(this.root)};a.prototype.get=function(a){return this.contents[a]};a.prototype.add=function(a,d){d=d||{};var b=this,c=
document.createElement("LI");c.className="wtab wtab-"+a.replace(/ /gi,"_");c.data=a;c.innerHTML=a;$(this.list).append(c);var e=document.createElement("div");d.id&&(e.id=d.id);e.className="wtabcontent wtabcontent-"+a+" "+(d.className||"");e.data=a;e.style.display="none";d.height&&(e.style.overflow="auto","full"==d.height?(e.style.height="calc( 100% - "+LiteGUI.Tabs.tabs_height+" )",e.style.height="-moz-calc( 100% - "+LiteGUI.Tabs.tabs_height+" )",e.style.height="-webkit-calc( 100% - "+LiteGUI.Tabs.tabs_height+
" )"):e.style.height=d.height);d.content&&("string"==typeof d.content?e.innerHTML=d.content:e.appendChild(d.content));$(this.root).append(e);this.contents[a]=e;$(c).click(function(c){if(!$(this).hasClass("selected")){c=this.data;var e=null,f;for(f in b.contents)f==c?($(b.contents[f]).show(),e=b.contents[f]):$(b.contents[f]).hide();$(b.list).find("li.wtab").removeClass("selected");$(this).addClass("selected");b.current_tab&&b.current_tab[0]!=c&&b.current_tab[2]&&b.current_tab[2].callback_leave&&b.current_tab[2].callback_leave(b.current_tab[0],
b.current_tab[1],b.current_tab[2]);b.current_tab=[c,e,d];d.callback&&d.callback(c,e);$(b).trigger("wchange",[c,e]);if(b.onchange)b.onchange(a,c,e);b.selected=a}});this.list.appendChild(c);!0!=d.selected&&null!=this.selected||this.select(a);return{tab:c,content:e}};a.prototype.select=function(a){for(var d=$(this.list).find("li.wtab"),b=0;b<d.length;b++)if(a==d[b].data){$(d[b]).click();break}};LiteGUI.Tabs=a;e.closing_time=500;e.prototype.clear=function(){$(this.content).empty();this.menu=[];this.panels=
[]};e.prototype.attachToPanel=function(a){$(a.content).prepend(this.root)};e.prototype.add=function(a,d){d=d||{};for(var b=this.menu.length,c=a.split("/"),e=0,f=0,p=this.menu;p;)if(p.length==f){f={children:[]};e==c.length-1&&(f.data=d);f.disable=function(){this.data&&(this.data.disabled=!0)};f.enable=function(){this.data&&delete this.data.disabled};f.name=c[e];p.push(f);e++;if(e==c.length)break;f.children=[];p=f.children;f=0}else{if(p[f]&&c[e]==p[f].name)if(e<c.length){p=p[f].children;f=0;e++;continue}else{trace("Warning: Adding menu that already exists: "+
a);break}f++}b!=this.menu.length&&this.updateMenu()};e.prototype.separator=function(a,d){var b=this.findMenu(a);b&&b.push({separator:!0,order:d||10})};e.prototype.findMenu=function(a){a=a.split("/");for(var d=0,b=0,c=this.menu;c;){if(d==a.length)return c;if(c.length<=b)break;if("*"==a[d])return c[b].children;if(a[d]==c[b].name)if(d<a.length){c=c[b].children;b=0;d++;continue}else return c[b];b++}return null};e.prototype.updateMenu=function(){var a=this;$(this.content).empty();for(var d in this.menu){var b=
document.createElement("li");b.innerHTML="<span class='icon'></span><span class='name'>"+this.menu[d].name+"</span>";this.content.appendChild(b);b.data=this.menu[d];this.menu[d].element=b;$(b).bind("click",function(b){var d=this.data;d.data&&d.data.callback&&"function"==typeof d.data.callback&&d.data.callback(d.data);a.is_open?(a.is_open=!1,a.hidePanels()):(a.is_open=!0,a.showMenu(d,b,this))});$(b).bind("mouseover",function(b){a.hidePanels();a.is_open&&a.showMenu(this.data,b,this)})}};e.prototype.hidePanels=
function(){if(this.panels.length){for(var a in this.panels)$(this.panels[a]).remove();this.panels=[]}};e.prototype.showMenu=function(a,b,c,e){e||this.hidePanels();if(a.children&&a.children.length){var f=this;f.closing_by_leave&&clearInterval(f.closing_by_leave);var n=document.createElement("div");n.className="litemenubar-panel";var p=[],m;for(m in a.children)p.push(a.children[m]);p.sort(function(a,b){var d=10,c=10;a&&a.data&&null!=a.data.order&&(d=a.data.order);a&&a.separator&&null!=a.order&&(d=a.order);
b&&b.data&&null!=b.data.order&&(c=b.data.order);b&&b.separator&&null!=b.order&&(c=b.order);return d-c});for(m in p){a=document.createElement("p");var l=p[m];a.className="litemenu-entry "+(a.children?" submenu":"");a.innerHTML=l&&l.name?"<span class='icon'></span><span class='name'>"+l.name+(l.children&&l.children.length?"<span class='more'>+</span>":"")+"</span>":"<span class='separator'></span>";a.data=l;if(a.data.data){l=a.data.data;if("checkbox"==l.type&&l.instance&&l.property&&!0==l.instance[l.property]||
!0==l.checkbox||l.instance&&l.property&&l.hasOwnProperty("value")&&l.instance[l.property]==l.value||"function"==typeof l.isChecked&&l.isChecked.call(l.instance,l))a.className+=" checked";l.disabled&&(a.className+=" disabled")}$(a).bind("click",function(){var a=this.data;if(a.data){if(a.data.disabled)return;a.data.instance&&a.data.property&&("checkbox"==a.data.type?(a.data.instance[a.data.property]=!a.data.instance[a.data.property],a.data.instance[a.data.property]?$(this).addClass("checked"):$(this).removeClass("checked")):
a.data.hasOwnProperty("value")&&(a.data.instance[a.data.property]=a.data.value));null!=a.data.checkbox&&(a.data.checkbox=!a.data.checkbox,a.data.checkbox?$(this).addClass("checked"):$(this).removeClass("checked"));a.data.callback&&"function"==typeof a.data.callback&&a.data.callback(a.data)}a.children&&a.children.length?f.showMenu(a,b,this,!0):(f.is_open=!1,f.hidePanels())});$(n).append(a)}$(n).bind("mouseleave",function(a){f.closing_by_leave&&clearInterval(f.closing_by_leave);f.closing_by_leave=setTimeout(function(){f.is_open=
!1;f.hidePanels()},LiteGUI.Menubar.closing_time)});$(n).bind("mouseenter",function(a){f.closing_by_leave&&clearInterval(f.closing_by_leave);f.closing_by_leave=null});c=$(c);n.style.left=c.offset().left+(e?200:0)+"px";n.style.top=c.offset().top+c.height()+(e?-20:2)+"px";this.panels.push(n);$(document.body).append(n);$(n).hide().show()}};LiteGUI.Menubar=e;LiteGUI.ContextualMenu=function(a,b){this.options=b=b||{};var c=this,e=document.createElement("div");e.className="litecontextualmenu litemenubar-panel";
e.style.minWidth=100;e.style.minHeight=100;this.root=e;for(var f in a){var n=document.createElement("div");n.className="litemenu-entry submenu";n.dataset.value=a[f];n.innerHTML=a.constructor==Array?a[f]:f;e.appendChild(n)}$(e).find(".litemenu-entry").click(function(a){a=this.dataset.value;b.callback&&b.callback.call(c,a);document.body.removeChild(e)});$(e).mouseleave(function(a){document.body.removeChild(e)});document.body.appendChild(e);f=b.left||0;n=b.top||0;if(b.event){f=b.event.pageX-10;var n=
b.event.pageY-10,p=document.body.getClientRects()[0];f>p.width-$(e).width()-10&&(f=p.width-$(e).width()-10);n>p.height-$(e).height()-10&&(n=p.height-$(e).height()-10)}e.style.left=f+"px";e.style.top=n+"px"};f.prototype.updateTree=function(a){this.root_item&&$(this.root_item).remove();a&&(a=this.createTreeItem(a,this.options),a.className+=" root_item",this.root.appendChild(a),this.root_item=a)};f.prototype.createTreeItem=function(a,b){var c=document.createElement("li");c.className="ltreeitem";a.id&&
(c.id=a.id);c.data=a;a.DOM=c;b=b||this.options;var e=document.createElement("div");e.className="ltreecontent";e.innerHTML=a.content||a.id||"";c.appendChild(e);c.content_element=e;$(c).find(".ltreecontent").click(function(a){this._editing||($(m.root).removeClass("selected"),$(m.root).find(".ltreecontent.selected").removeClass("selected"),$(this).addClass("selected"),a=this.parentNode,$(m).trigger("item_selected",[a.data,a]),a.callback&&a.callback.call(m,a))});$(c).find(".ltreecontent").dblclick(function(a){var b=
this.parentNode;$(m).trigger("item_dblclicked",[b.data,b]);if(!this._editing&&m.options.allow_rename){this._editing=!0;this._old_name=this.innerHTML;var d=this;this.innerHTML="<input type='text' value='"+this.innerHTML+"' />";var c=$(this).find("input")[0];$(c).blur(function(a){d.innerHTML=a.target.value;delete d._editing;$(m).trigger("item_renamed",[d._old_name,a.target.value,b]);delete d._old_name});$(c).bind("keydown",function(a){13==a.keyCode&&$(this).blur()});$(c).focus();a.preventDefault()}});
var f=document.createElement("ul");f.className="ltreelist";c.list=f;if(a.children)for(var n in a.children){var p=this.createTreeItem(a.children[n],b);f.appendChild(p)}c.appendChild(f);var m=this;e.draggable=!0;e.addEventListener("dragstart",function(a){a.dataTransfer.setData("node-id",this.parentNode.id)});e.addEventListener("dragenter",function(a){a.preventDefault()});e.addEventListener("dragover",function(a){a.preventDefault()});e.addEventListener("drop",function(a){a.preventDefault();var b=a.dataTransfer.getData("node-id");
if(""!=b)try{m.moveItem(b,this.parentNode.id)&&$(m).trigger("item_moved",[m.getItem(b),m.getItem(this.parentNode.id)])}catch(d){trace("Error: "+d)}else $(m).trigger("drop_on_item",[this,a])});return c};f.prototype.getItem=function(a){a=$(this.root).find("#"+a);if(!a.length)return null;if(!$(a).hasClass("ltreeitem"))throw"this node is not a tree item";return a[0]};f.prototype.setSelectedItem=function(a){if(a){a=this.getItem(a);if(!a)return null;if($(a).hasClass("selected"))return a;$(this.root).removeClass("selected");
$(this.root).find(".ltreecontent.selected").removeClass("selected");$(a.content_element).addClass("selected");return a}$(this.root).removeClass("selected");$(this.root).find(".ltreecontent.selected").removeClass("selected")};f.prototype.getSelectedItem=function(){var a=$(that.root).find(".ltreecontent.selected");return a.length?a[0]:null};f.prototype.insertItem=function(a,b,c,e){var f=this.root_item;if(b&&(f="string"==typeof b?this.getItem(b):b,!f))return null;if(!$(f).hasClass("ltreeitem"))throw"this node is not a tree item";
a=this.createTreeItem(a,e);void 0==c?f.list.appendChild(a):(trace(f.list.childNodes),f.list.insertBefore(a,f.list.childNodes[c]));return a};f.prototype.moveItem=function(a,b){var c=this.getItem(b),e=this.getItem(a);if(!c||!e)return!1;c.list.appendChild(e);return!0};f.prototype.removeItem=function(a){(a=this.getItem(a))&&$(a).remove()};f.prototype.updateItem=function(a,b){var c=this.getItem(a);c&&(c.data=b,b.id&&(c.id=b.id),b.content&&(c.content_element.innerHTML=b.content))};f.prototype.clear=function(a){$(a?
this.root_item:this.root).find(".ltreeitem").remove()};LiteGUI.Tree=f;LiteGUI.List=function(a,b,c){c=c||{};var e=document.createElement("ul");this.root=e;e.id=a;e.className="litelist";this.items=[];var f=this;this.callback=c.callback;for(var n in b){a=document.createElement("li");a.className="list-item";a.data=b[n];var p="";"string"==typeof b[n]?p=b[n]+"<span class='arrow'></span>":(p=(b[n].name||b[n].title||"")+"<span class='arrow'></span>",b[n].id&&(a.id=b[n].id));a.innerHTML=p;e.appendChild(a)}$(e).find(".list-item").click(function(){$(e).find(".list-item.selected").removeClass("selected");
$(this).addClass("selected");$(f).trigger("wchanged",this);f.callback&&f.callback(this.data)});c.parent&&(c.parent.root?$(c.parent.root).append(e):$(c.parent).append(e))};LiteGUI.Dragger=function(a,b){function c(a){var e=[a.screenX-h.data[0],h.data[1]-a.screenY];h.data=[a.screenX,a.screenY];f(e[b.horizontal?0:1],a);a.stopPropagation();a.preventDefault();return!1}function e(a){$(h).trigger("stop_dragging");$(document).unbind("mousemove",c);$(document).unbind("mouseup",e);$(h).trigger("blur");a.stopPropagation();
a.preventDefault();return!1}function f(a,c){var e=b.step?b.step:1;c&&c.shiftKey?e*=10:c&&c.ctrlKey&&(e*=0.1);e=parseFloat(l.value)+a*e;null!=b.max&&e>b.max&&(e=b.max);null!=b.min&&e<b.min&&(e=b.min);l.value=b.precision?e.toFixed(b.precision):(1E3*e<<0)/1E3;b.units&&(l.value+=b.units);$(l).change()}b=b||{};var n=document.createElement("div");n.className="dragger "+(b.extraclass?b.extraclass:"");var p=document.createElement("span");p.className="inputfield "+(b.extraclass?b.extraclass:"");b.disabled&&
(p.className+=" disabled");n.appendChild(p);var m=b.dragger_class||"full",l=document.createElement("input");l.className="text number "+(m?m:"");l.value=a+(b.units?b.units:"");l.tabIndex=b.tab_index;this.input=l;this.setValue=function(a){$(l).val(a).trigger("change")};$(l).bind("keydown",function(a){if(38==a.keyCode)f(1,a);else if(40==a.keyCode)f(-1,a);else return;a.stopPropagation();a.preventDefault();return!0});b.disabled&&(l.disabled=!0);b.tab_index&&(l.tabIndex=b.tab_index);p.appendChild(l);n.input=
l;var h=document.createElement("div");h.className="drag_widget";b.disabled&&(h.className+=" disabled");p.appendChild(h);n.dragger=h;this.root=n;$(h).bind("mousedown",function(a){b.disabled||($(document).bind("mousemove",c),$(document).bind("mouseup",e),h.data=[a.screenX,a.screenY],$(h).trigger("start_dragging"));a.stopPropagation();a.preventDefault()})};LiteGUI.LineEditor=function(a,b){function c(a){return[q.width*((h.xrange[1]-h.xrange[0])*a[0]+h.xrange[0]),q.height*((h.yrange[1]-h.yrange[0])*a[1]+
h.yrange[0])]}function e(a){return[(a[0]/q.width-h.xrange[0])/(h.xrange[1]-h.xrange[0]),(a[1]/q.height-h.yrange[0])/(h.yrange[1]-h.yrange[0])]}function f(a){var b=q.getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;0>c?c=0:c>q.width&&(c=q.width);0>d?d=0:d>q.height&&(d=q.height);if(-1!=r&&m([a.clientX-b.left,a.clientY-b.top],[c,d])>0.5*q.height)h.value.splice(r,1),n(a);else{b=e([-(s[0]-c),s[1]-d]);if(-1!=r){var g=h.xrange[0],k=h.xrange[1];h.no_trespassing&&(0<r&&(g=h.value[r-1][0]),r<h.value.length-
1&&(k=h.value[r+1][0]));var t=h.value[r];t[0]+=b[0];t[1]+=b[1];t[0]<g?t[0]=g:t[0]>k&&(t[0]=k);t[1]<h.yrange[0]?t[1]=h.yrange[0]:t[1]>h.yrange[1]&&(t[1]=h.yrange[1])}l();h.redraw();s[0]=c;s[1]=d;p();a.preventDefault();a.stopPropagation()}}function n(a){r=-1;h.redraw();$(document).unbind("mousemove",f);$(document).unbind("mouseup",n);p();a.preventDefault();a.stopPropagation()}function p(){b.callback?b.callback.call(h,h.value):$(h).change()}function m(a,b){return Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-
a[1],2))}function l(){var a=null;-1!=r&&(a=h.value[r]);h.value.sort(function(a,b){return a[0]>b[0]});a&&(r=h.value.indexOf(a))}b=b||{};var h=document.createElement("div");h.className="curve "+(b.extraclass?b.extraclass:"");h.style.minHeight="50px";h.style.width=b.width||"100%";h.bgcolor=b.bgcolor||"#222";h.pointscolor=b.pointscolor||"#5AF";h.linecolor=b.linecolor||"#444";h.value=a||[];h.xrange=b.xrange||[0,1];h.yrange=b.yrange||[0,1];h.defaulty=null!=b.defaulty?b.defaulty:0.5;h.no_trespassing=b.no_trespassing||
!1;h.show_samples=b.show_samples||0;h.options=b;var q=document.createElement("canvas");q.width=b.width||200;q.height=b.height||50;h.appendChild(q);h.canvas=q;$(q).bind("mousedown",function(a){$(document).bind("mousemove",f);$(document).bind("mouseup",n);for(var b=q.getBoundingClientRect(),d=a.clientX-b.left,b=a.clientY-b.top,g=q.height-b,p=1E5,x=-1,w=0;w<h.value.length;w++){var v=c(h.value[w]),v=m([d,g],v);v<p&&8>v&&(p=v,x=w)}r=x;-1==r&&(g=e([d,q.height-b]),h.value.push(g),l(),r=h.value.indexOf(g));
s=[d,b];h.redraw();a.preventDefault();a.stopPropagation()});$(h).resize(function(a){q.width=$(this).width();q.height=$(this).height();h.redraw()});h.getValueAt=function(a){if(a<h.xrange[0]||a>h.xrange[1])return h.defaulty;for(var b=[h.xrange[0],h.defaulty],c=0,c=0;c<h.value.length;c+=1){var d=h.value[c];if(a==d[0])return d[1];if(a<d[0])return c=(a-b[0])/(d[0]-b[0]),b[1]*(1-c)+d[1]*c;b=d}d=[h.xrange[1],h.defaulty];c=(a-b[0])/(d[0]-b[0]);return b[1]*(1-c)+d[1]*c};h.resample=function(a){var b=[];a=(h.xrange[1]-
h.xrange[0])/a;for(var c=h.xrange[0];c<=h.xrange[1];c+=a)b.push(h.getValueAt(c));return b};h.addValue=function(a){for(var b=0;b<h.value;b++)if(!(h.value[b][0]<a[0])){h.value.splice(b,0,a);redraw();return}h.value.push(a);redraw()};var r=-1;h.redraw=function(){var a=q.getContext("2d");a.setTransform(1,0,0,1,0,0);a.translate(0,q.height);a.scale(1,-1);a.fillStyle=h.bgcolor;a.fillRect(0,0,q.width,q.height);a.strokeStyle=h.linecolor;a.beginPath();var b=c([h.xrange[0],h.defaulty]);a.moveTo(b[0],b[1]);for(var d in h.value)b=
h.value[d],b=c(b),a.lineTo(b[0],b[1]);b=c([h.xrange[1],h.defaulty]);a.lineTo(b[0],b[1]);a.stroke();for(d=0;d<h.value.length;d+=1)b=h.value[d],b=c(b),a.fillStyle=r==d?"white":h.pointscolor,a.beginPath(),a.arc(b[0],b[1],r==d?4:2,0,2*Math.PI),a.fill();if(h.show_samples){var e=h.resample(h.show_samples);a.fillStyle="#888";for(d=0;d<e.length;d+=1)b=[d*((h.xrange[1]-h.xrange[0])/h.show_samples)+h.xrange[0],e[d]],b=c(b),a.beginPath(),a.arc(b[0],b[1],2,0,2*Math.PI),a.fill()}};var s=[0,0];h.redraw();return h}})();
jQuery.fn.wchange=function(c){$(this[0]).bind("wchange",c)};jQuery.fn.wclick=function(c){$(this[0]).bind("wclick",c)};
function Inspector(c,b){b=b||{};this.root=document.createElement("DIV");this.root.className="inspector "+(b.full?"full":"");b.one_line&&(this.root.className+=" one-line");c&&(this.root.id=c);this.values={};this.sections=[];this.widgets={};this.addSection();this.tab_index=Math.floor(1E4*Math.random());b.name_width&&(this.widget_name_width=b.name_width);b.parent&&this.appendTo(b.parent);this.widgets_per_row=b.widgets_per_row||1}Inspector.prototype.appendTo=function(c,b){b?$(c).prepend(this.root):$(c).append(this.root)};
Inspector.prototype.clear=function(){$(this.root).empty();this.sections=[];this.values={};this.widgets={};this.addSection()};Inspector.prototype.append=function(c){var b=this.root;this.current_group_content?b=this.current_group_content:this.current_section_content&&(b=this.current_section_content);b.appendChild(c)};Inspector.prototype.setup=function(c){for(var b in c){var a=c[b];this.add(a.type,a.name,a.value,a.options)}};
Inspector.prototype.inspectInstance=function(c,b,a){if(c){b=!b&&c.getAttributes?c.getAttributes():this.collectAttributes(c);var e=c.constructor;!a&&e.attributes&&(a=e.attributes);a||(a={});for(var f in b)if(!a[f]){var g=b[f];if(e["@"+f]){var g={},d=e["@"+f],k;for(k in d)g[k]=d[k];a[f]=g}else if(c["@"+f])a[f]=c["@"+f];else if("number"==typeof g)a[f]={type:"number"};else if("string"==typeof g)a[f]={type:"string"};else if("boolean"==typeof g)a[f]={type:"boolean"};else if(g&&g.length)switch(g.length){case 2:a[f]=
{type:"vec2"};break;case 3:a[f]={type:"vec3"};break;case 4:a[f]={type:"vec4"}}}return this.showAttributes(c,a)}};Inspector.prototype.collectAttributes=function(c){var b={},a;for(a in c)if("_"!=a[0]&&"@"!=a[0]&&"jQuery"!=a.substr(0,6)){var e=c[a];e&&e.constructor==Function||(b[a]=e)}return b};
Inspector.prototype.showAttributes=function(c,b){for(var a in b){var e=b[a];e.callback||(e.callback=Inspector.assignValue.bind({instance:c,name:a,options:e}));e.instance=c;this.add(e.type||e.widget||"string",a,c[a],e)}};
Inspector.assignValue=function(c){var b=this.instance,a=b[this.name];if(null==a||null==c)b[this.name]=c;else if("number"==typeof a)b[this.name]=parseFloat(c);else if("string"==typeof a)b[this.name]=c;else if(c&&c.length&&a&&a.length)for(b=0;b<a.length;++b)a[b]=c[b];else b[this.name]=c};
Inspector.prototype.createWidget=function(c,b,a){a=a||{};b=b||"";var e=document.createElement("DIV");e.className="widget "+(a.className||"");e.inspector=this;e.options=a;e.name=c;a.width&&(e.style.width="string"==typeof a.width?a.width:a.width+"px",e.style.minWidth=e.style.width);c&&(this.widgets[c]=e);1!=this.widgets_per_row&&(a.width||(e.style.width=(100/this.widgets_per_row).toFixed(2)+"%"),e.style.display="inline-block");var f="",g="";if(this.widget_name_width||a.widget_name_width)g=this.widget_name_width||
a.widget_name_width,"number"==typeof g&&(g=g.toFixed()+"px"),f="style='width: calc("+g+" - 0px); width: -webkit-calc("+g+" - 0px); width: -moz-calc("+g+" - 0px); '",g="style='width: calc( 100% - "+g+"); width: -webkit-calc(100% - "+g+"); width: -moz-calc( 100% - "+g+"); '";a="";var d="wcontent ";null==c?d+=" full":a=""==c?"<span class='wname' title='"+c+"' "+f+"></span>":"<span class='wname' title='"+c+"' "+f+">"+c+"<span class='filling'>....................</span> </span>";"string"==typeof b?e.innerHTML=
a+"<span class='info_content "+d+"' "+g+">"+b+"</span>":(e.innerHTML=a+"<span class='info_content "+d+"' "+g+"></span>",$(e).find("span.info_content").append(b));return e};Inspector.onWidgetChange=function(c,b,a,e){this.values[b]=a;$(this.current_section).trigger("wchange",a);e.callback&&e.callback.call(c,a);$(c).trigger("wchange",a);if(this.onchange)this.onchange(b,a,c)};
Inspector.widget_constructors={title:"addTitle",info:"addInfo",number:"addNumber",slider:"addSlider",string:"addString",text:"addString",textarea:"addTextarea",color:"addColor","boolean":"addCheckbox",checkbox:"addCheckbox",vec2:"addVector2",vector2:"addVector2",vec3:"addVector3",vector3:"addVector3",combo:"addCombo",button:"addButton",buttons:"addButtons",file:"addFile",line:"addLine",list:"addList",separator:"addSeparator"};
Inspector.prototype.add=function(c,b,a,e){"object"==typeof c&&1==arguments.length&&(e=c,c=e.type,b=e.name,a=e.value);var f=Inspector.widget_constructors[c];if(f&&("string"==typeof f&&(f=Inspector.prototype[f]),f&&"function"==typeof f))return"function"==typeof e&&(e={callback:e}),f.call(this,b,a,e)};Inspector.prototype.getValue=function(c){return this.values[c]};Inspector.prototype.set=function(c,b){};
Inspector.prototype.addSection=function(c,b){b=b||{};this.current_group&&this.endGroup();var a=document.createElement("DIV");a.className="wsection";c||(a.className+=" notitle");var e="";c&&(e+="<div class='wsectiontitle'>"+(b.no_minimize?"":"<span class='switch-section-button'></span>")+c+"</div>");a.innerHTML=e+"<div class='wsectioncontent'></div>";this.root.appendChild(a);c&&$(a).find(".wsectiontitle").click(function(b){"button"!=b.target.localName&&($(a).toggleClass("minimized"),$(a).find(".wsectioncontent").toggle())});
this.current_section=a;this.content=this.current_section_content=$(a).find(".wsectioncontent")[0];b.widgets_per_row&&(this.widgets_per_row=b.widgets_per_row);return a};
Inspector.prototype.beginGroup=function(c,b){b=b||{};this.current_group&&this.endGroup();var a=document.createElement("DIV");a.className="wgroup";a.innerHTML="<div class='wgroupheader "+(b.title?"wtitle":"")+"'><span class='wgrouptoggle'>-</span>"+c+"</div>";var e=document.createElement("DIV");e.className="wgroupcontent";b.collapsed&&(e.style.display="none");a.appendChild(e);var f=b.collapsed||!1;$(a).find(".wgroupheader").click(function(){$(a).find(".wgroupcontent").toggle();f=!f;$(a).find(".wgrouptoggle").html(f?
"+":"-")});this.append(a);this.current_group=a;this.content=this.current_group_content=e;return a};Inspector.prototype.endGroup=function(c){this.current_group_content=this.current_group=null;this.content=this.current_section_content};
Inspector.prototype.addTitle=function(c,b){b=b||{};var a=document.createElement("DIV"),e="<span class='wtitle'><span class='text'>"+c+"</span>";b.help&&(e+="<span class='help'><div class='help-content'>"+b.help+"</div></span>");a.innerHTML=e+"</span>";a.setValue=function(a){$(this).find(".text").html(a)};this.append(a);return a};Inspector.prototype.addSeparator=function(){var c=document.createElement("DIV");c.className="separator";this.append(c);return c};
Inspector.prototype.addString=function(c,b,a){a=a||{};b=b||"";var e=this;this.values[c]=b;var f="text";a.password&&(f="password");var g=this.createWidget(c,"<span class='inputfield full "+(a.disabled?"disabled":"")+"'><input type='"+f+"' tabIndex='"+this.tab_index+"' class='text string' value='"+b+"' "+(a.disabled?"disabled":"")+"/></span>",a);$(g).find(".wcontent input").change(function(b){Inspector.onWidgetChange.call(e,g,c,b.target.value,a)});this.tab_index+=1;g.setValue=function(a){$(this).find("input").val(a).change()};
g.wchange=function(a){$(this).wchange(a)};this.append(g);return g};
Inspector.prototype.addStringButton=function(c,b,a){a=a||{};b=b||"";var e=this;this.values[c]=b;var f=this.createWidget(c,"<span class='inputfield button'><input type='text' tabIndex='"+this.tab_index+"' class='text string' value='"+b+"' "+(a.disabled?"disabled":"")+"/></span><button class='micro'>"+(a.button||"...")+"</button>",a);$(f).find(".wcontent input").change(function(b){Inspector.onWidgetChange.call(e,f,c,b.target.value,a)});$(f).find(".wcontent button").click(function(b){a.callback_button&&
a.callback_button.call(f,$(f).find(".wcontent input").val())});this.tab_index+=1;this.append(f);f.wchange=function(a){$(this).wchange(a)};f.wclick=function(a){$(this).wclick(a)};return f};
Inspector.prototype.addNumber=function(c,b,a){a=a||{step:0.1};b=b||0;var e=this;this.values[c]=b;var f=this.createWidget(c,"",a);this.append(f);a.extraclass="full";a.tab_index=this.tab_index;a.dragger_class="full";this.tab_index++;b=new LiteGUI.Dragger(b,a);$(f).find(".wcontent").append(b.root);$(b).bind("start_dragging",function(b){a.callback_before&&a.callback_before.call(f)});$(f).find("input").change(function(b){e.values[c]=b.target.value;if(a.callback){var d=a.callback.call(f,parseFloat(b.target.value));
"number"==typeof d&&$(this).val(d)}$(f).trigger("wchange",b.target.value);if(e.onchange)e.onchange(c,b.target.value,f)});f.setValue=function(a){$(this).find("input").val(a).change()};return f};
Inspector.prototype.addVector2=function(c,b,a){function e(b){a.callback_before&&a.callback_before()}a=a||{step:0.1};b=b||[0,0];var f=this;this.values[c]=b;var g=this.createWidget(c,"",a);a.step=a.step||0.1;a.dragger_class="medium";a.tab_index=this.tab_index;this.tab_index++;var d=new LiteGUI.Dragger(b[0],a);d.root.style.marginLeft=0;$(g).find(".wcontent").append(d.root);a.tab_index=this.tab_index;this.tab_index++;var k=new LiteGUI.Dragger(b[1],a);$(g).find(".wcontent").append(k.root);$(d).bind("start_dragging",
e);$(k).bind("start_dragging",e);$(g).find("input").change(function(b){b=[];for(var d=$(g).find("input"),e=0;e<d.length;e++)b.push(parseFloat(d[e].value));f.values[c]=b;if(a.callback){var k=a.callback.call(g,b);if("object"==typeof k&&2<=k.length){for(e=0;e<d.length;e++)$(d[e]).val(k[e]);b=k}}$(g).trigger("wchange",[b]);if(f.onchange)f.onchange(c,b,g)});this.append(g);g.setValue=function(a){d.setValue(a[0]);k.setValue(a[1])};return g};
Inspector.prototype.addVector3=function(c,b,a){function e(b){a.callback_before&&a.callback_before()}a=a||{step:0.1};b=b||[0,0,0];var f=this;this.values[c]=b;var g=this.createWidget(c,"",a);a.step=a.step||0.1;a.dragger_class="mini";a.tab_index=this.tab_index;this.tab_index++;var d=new LiteGUI.Dragger(b[0],a);d.root.style.marginLeft=0;$(g).find(".wcontent").append(d.root);a.tab_index=this.tab_index;this.tab_index++;var k=new LiteGUI.Dragger(b[1],a);$(g).find(".wcontent").append(k.root);a.tab_index=
this.tab_index;this.tab_index++;var u=new LiteGUI.Dragger(b[2],a);$(g).find(".wcontent").append(u.root);$(d).bind("start_dragging",e);$(k).bind("start_dragging",e);$(u).bind("start_dragging",e);$(g).find("input").change(function(b){b=[];for(var d=$(g).find("input"),e=0;e<d.length;e++)b.push(parseFloat(d[e].value));f.values[c]=b;if(a.callback){var k=a.callback.call(g,b);if("object"==typeof k&&3<=k.length){for(e=0;e<d.length;e++)$(d[e]).val(k[e]);b=k}}$(g).trigger("wchange",[b]);if(f.onchange)f.onchange(c,
b,g)});this.append(g);g.setValue=function(a){d.setValue(a[0]);k.setValue(a[1]);u.setValue(a[2])};return g};
Inspector.prototype.addTextarea=function(c,b,a){a=a||{};b=b||"";var e=this;this.values[c]=b;var f=this.createWidget(c,"<span class='inputfield textarea "+(a.disabled?"disabled":"")+"'><textarea tabIndex='"+this.tab_index+"' "+(a.disabled?"disabled":"")+">"+b+"</textarea></span>",a);this.tab_index++;$(f).find(".wcontent textarea").bind(a.inmediate?"keyup":"change",function(b){Inspector.onWidgetChange.call(e,f,c,b.target.value,a)});a.height&&$(f).find("textarea").css({height:a.height});this.append(f);
f.setValue=function(a){$(this).find("textarea").val(a).change()};return f};Inspector.prototype.addInfo=function(c,b,a){a=a||{};b=b||"";var e=null;null!=c?e=this.createWidget(c,b,a):(e=document.createElement("div"),e.className=a.className,e.innerHTML="<span class='winfo'>"+b+"</span>");e.setValue=function(a){$(this).find(".winfo").html(a)};a.height&&(c=$(e).find("span.info_content")[0],c.style.height="string"==typeof a.height?a.height:a.height+"px",c.style.overflow="auto");this.append(e);return e};
Inspector.prototype.addSlider=function(c,b,a){a=a||{};a.min=a.min||0;a.max=a.max||1;a.step=a.step||0.01;var e=this;this.values[c]=b;var f=this.createWidget(c,"<span class='inputfield'>\t\t\t\t<input tabIndex='"+this.tab_index+"' type='text' class='slider-text fixed nano' value='"+b+"' /></span>\t\t\t\t<span class='ui-slider'>\t\t\t\t<input class='slider-input' type='range' step='"+a.step+"' min='"+a.min+"' max='"+a.max+"'/><span class='slider-thumb'></span></span>",a);this.tab_index++;var g=$(f).find(".slider-text"),
d=$(f).find(".slider-input"),k=$(f).find(".slider-thumb");d.bind("input",function(b){b=parseFloat(b.target.value);var d=(b-a.min)/(a.max-a.min);u||(g.val(b),Inspector.onWidgetChange.call(e,f,c,b,a));k.css({left:(90*d).toFixed(2)+"%"})});var u=!1;g.bind("change",function(){if(!u){var b=parseFloat($(this).val());b>a.max?(u=!0,d.val(a.max),u=!1):d.val(b);var g=(b-a.min)/(a.max-a.min);1<g?g=1:0>g&&(g=0);k.css({left:g*($(d).width()-12)});Inspector.onWidgetChange.call(e,f,c,b,a)}});this.append(f);f.setValue=
function(a){g.val(a)};u=!0;d.val(b).trigger("input");u=!1;return f};
Inspector.prototype.addCheckbox=function(c,b,a){a=a||{};b=b||"";var e=this;this.values[c]=b;var f=this.createWidget(c,"<span class='inputfield'><span tabIndex='"+this.tab_index+"' class='fixed flag checkbox "+(b?"on":"off")+"'>"+(b?"on":"off")+"</span></span>",a);this.tab_index++;$(f).find(".wcontent .checkbox").keypress(function(a){32==a.keyCode&&$(this).click()});$(f).click(function(){var b=!this.data;this.data=b;$(f).find("span.flag").html(b?"on":"off");b?$(f).find("span.checkbox").addClass("on"):
$(f).find("span.checkbox").removeClass("on");Inspector.onWidgetChange.call(e,f,c,b,a)})[0].data=b;f.setValue=function(a){e.values[c]!=a&&$(this).find(".checkbox").click()};this.append(f);return f};Inspector.prototype.addFlags=function(c,b){var a={},e;for(e in c)a[e]=c[e];if(b)for(e in b)"undefined"==typeof a[e]&&(a[e]=b[e]?!0:!1);for(e in a)this.addCheckbox(e,a[e],{callback:function(a){return function(b){c[a]=b}}(e)})};
Inspector.prototype.addCombo=function(c,b,a){a=a||{};var e=this;this.values[c]=b;var f="<select tabIndex='"+this.tab_index+"' "+(a.disabled?"disabled":"")+" class='"+(a.disabled?"disabled":"")+"'>";this.tab_index++;var g=this.createWidget(c,"<span class='inputfield full inputcombo "+(a.disabled?"disabled":"")+"'></span>",a);g.options=a;var d=a.values||[];if(a.values&&(d="function"==typeof d?a.values():a.values))for(var k in d)f+="<option "+(d[k]==b?" selected":"")+">"+(d.length?d[k]:k)+"</option>";
f+="</select>";g.querySelector("span.inputcombo").innerHTML=f;$(g).find(".wcontent select").change(function(b){b=b.target.value;d&&d.constructor!=Array&&(b=d[b]);Inspector.onWidgetChange.call(e,g,c,b,a)});this.append(g);return g};
Inspector.prototype.addComboButtons=function(c,b,a){a=a||{};b=b||"";var e=this;this.values[c]=b;var f="";if(a.values)for(var g in a.values)f+="<button class='wcombobutton "+(b==a.values[g]?"selected":"")+"' data-name='options.values[i]'>"+a.values[g]+"</button>";var d=this.createWidget(c,f,a);$(d).find(".wcontent button").click(function(b){b=b.target.innerHTML;e.values[c]=b;$(d).find(".selected").removeClass("selected");$(this).addClass("selected");Inspector.onWidgetChange.call(e,d,c,b,a)});this.append(d);
return d};
Inspector.prototype.addTags=function(c,b,a){function e(b){if(!d.tags[b]){d.tags[b]=!0;var e=document.createElement("div");e.data=b;e.className="wtag";e.innerHTML=b+"<span class='close'>X</span>";$(e).find(".close").click(function(b){b=$(this).parent()[0].data;delete d.tags[b];$(this).parent().remove();$(d).trigger("wremoved",b);Inspector.onWidgetChange.call(f,d,c,d.tags,a)});$(d).find(".wtagscontainer").append(e);f.values[c]=d.tags;a.callback&&a.callback.call(d,d.tags);$(d).trigger("wchange",d.tags);
$(d).trigger("wadded",b);if(f.onchange)f.onchange(c,d.tags,d)}}a=a||{};b=b||[];var f=this;this.values[c]=b;b="<select>";if(a.values)for(var g in a.values)b+="<option>"+a.values[g]+"</option>";var d=this.createWidget(c,"<span class='inputfield full'>"+(b+"</select><div class='wtagscontainer inputfield'></div>")+"</span>",a);d.tags={};for(g in a.value)e(a.value[g]);$(d).find(".wcontent select").change(function(a){e(a.target.value)});this.append(d);return d};
Inspector.prototype.addList=function(c,b,a){function e(a){var b=$(k).find("li.selected");b&&b.length&&(40==a.keyCode?(a=b.next())&&a.length&&$(a[0]).click():38==a.keyCode&&(a=b.prev())&&a.length&&$(a[0]).click())}function f(d){a.multiselection?$(this).toggleClass("selected"):($(k).find("li").removeClass("selected"),$(this).addClass("selected"));d=b[this.dataset.pos];Inspector.onWidgetChange.call(g,k,c,d,a);$(k).trigger("wadded",d)}a=a||{};var g=this,d="";a.height&&(d="style='height: "+a.height+"px; overflow: auto;'");
d="<ul class='lite-list' "+d+" tabIndex='"+this.tab_index+"'><ul>";this.tab_index++;var k=this.createWidget(c,"<span class='inputfield full "+(a.disabled?"disabled":"")+"'>"+d+"</span>",a);$(k).find("ul").focus(function(){$(document).bind("keypress",e)});$(k).find("ul").blur(function(){$(document).unbind("keypress",e)});k.updateItems=function(a){var c="";if(b=a)for(var d in b){a=b[d];var e="";null==b[d].length&&(a=b[d].name?b[d].name:d,b[d].icon&&(e="<img src='"+b[d].icon+"' class='icon' />"));c+=
"<li className='item-"+d+" "+("object"==typeof b[d]&&b[d].selected?"selected":"")+"' data-name='"+a+"' data-pos='"+d+"'>"+e+a+"</li>"}$(this).find("ul").html(c);$(this).find(".wcontent li").click(f)};k.removeItem=function(a){for(var b=$(k).find(".wcontent li"),c=0;c<b.length;c++)b[c].dataset.name==a&&$(b[c]).remove()};k.updateItems(b);this.append(k);a.height&&$(k).scroll(0);return k};
Inspector.prototype.addButton=function(c,b,a){a=a||{};b=b||"";var e=this,f=this.createWidget(c,"<button tabIndex='"+this.tab_index+"'>"+b+"</button>",a);this.tab_index++;$(f).find("button").click(function(){Inspector.onWidgetChange.call(e,f,c,this.innerHTML,a);$(f).trigger("wclick",b)});this.append(f);f.wclick=function(a){$(this).wclick(a)};return f};
Inspector.prototype.addButtons=function(c,b,a){a=a||{};b=b||"";var e=this,f="",g="calc("+(100/b.length).toFixed(3)+"% - "+Math.floor(16/b.length)+"px);";if(b&&"object"==typeof b)for(var d in b)f+="<button tabIndex='"+this.tab_index+"' style=' width:"+g+" width: -moz-"+g+" width: -webkit-calc("+(89/b.length).toFixed(3)+"%)'>"+b[d]+"</button>",this.tab_index++;var k=this.createWidget(c,f,a);$(k).find("button").click(function(){Inspector.onWidgetChange.call(e,k,c,this.innerHTML,a);$(k).trigger("wclick",
this.innerHTML)});this.append(k);return k};
Inspector.prototype.addColor=function(c,b,a){a=a||{};b=b||[0,0,0];var e=this;this.values[c]=b;var f="<input tabIndex='"+this.tab_index+"' id='colorpicker-"+c+"' class='color' value='"+b+"' "+(a.disabled?"disabled":"")+"/>";this.tab_index++;a.show_rgb&&(f+="<span class='rgb-color'>"+Inspector.parseColor(b)+"</span>");var g=this.createWidget(c,f,a);this.append(g);var f=$(g).find("input.color")[0],d=new jscolor.color(f);d.pickerFaceColor="#333";d.pickerBorderColor="black";d.pickerInsetColor="#222";d.rgb_intensity=
1;a.disabled&&(d.pickerOnfocus=!1);"string"!=typeof b&&b.length&&2<b.length&&(d.fromRGB(1*b[0],1*b[1],1*b[2]),d.rgb_intensity=1);$(f).change(function(a){$(g).find(".rgb-color").html(Inspector.parseColor(d.rgb))});d.onImmediateChange=function(){var b=[d.rgb[0]*d.rgb_intensity,d.rgb[1]*d.rgb_intensity,d.rgb[2]*d.rgb_intensity];e.values[c]=b;a.callback&&a.callback.call(g,b.concat(),"#"+d.toString(),d);$(g).trigger("wchange",[b.concat(),d.toString()]);if(e.onchange)e.onchange(c,b.concat(),g)};a.step=
a.step||0.01;a.dragger_class="nano";b=new LiteGUI.Dragger(1,a);$(g).find(".wcontent").append(b.root);$(b.input).change(function(){var a=parseFloat($(this).val());d.rgb_intensity=a;if(d.onImmediateChange)d.onImmediateChange()});return g};
Inspector.prototype.addFile=function(c,b,a){a=a||{};b=b||"";var e=this;this.values[c]=b;var f=this.createWidget(c,"<span class='inputfield full whidden'><span class='filename'>"+b+"</span><input type='file' size='100' class='file' value='"+b+"'/></span>",a);$(f).find(".wcontent input").change(function(b){a.callback&&a.callback.call(f,b.target.value);$(f).find(".filename").html(b.target.value);$(f).trigger("wchange",[b.target.files]);Inspector.onWidgetChange.call(e,f,c,b.target.value,a)});this.append(f);
return f};Inspector.prototype.addLine=function(c,b,a){a=a||{};b=b||"";var e=this;this.values[c]=b;var f=this.createWidget(c,"<span class='line-editor'></span>",a);b=new LiteGUI.LineEditor(b,a);$(f).find("span.line-editor").append(b);$(b).change(function(b){a.callback&&a.callback.call(f,b.target.value);$(f).trigger("wchange",[b.target.value]);Inspector.onWidgetChange.call(e,f,c,b.target.value,a)});this.append(f);return f};
Inspector.prototype.addTree=function(c,b,a){function e(a,b){for(var c in b){var k=document.createElement("div");k.className="treenode";"object"==typeof b[c]?(k.innerHTML="<span class='itemname'>"+c+"</span><span class='itemcontent'></span>",e($(k).find(".itemcontent")[0],b[c])):k.innerHTML="<span class='itemname'>"+c+"</span><span class='itemvalue'>"+b[c]+"</span>";a.appendChild(k)}}a=a||{};b=b||"";c=this.createWidget(c,"<div class='wtree'></div>",a);a=$(c).find(".wtree")[0];e(a,b);this.append(c);
return c};Inspector.parseColor=function(c){return"<span style='color: #FAA'>"+c[0].toFixed(2)+"</span>,<span style='color: #AFA'>"+c[1].toFixed(2)+"</span>,<span style='color: #AAF'>"+c[2].toFixed(2)+"</span>"};LiteGUI.Inspector=Inspector;
