var trace=console?console.log.bind(console):function(){},LiteGUI={root_container:null,panels:{},undo_steps:[],modalbg_div:null,_modules_initialized:!1,mainmenu:null,modules:[],init:function(c){c=c||{};trace("Init lite");c.width&&c.height&&this.setWindowSize(c.width,c.height);this.root_container=$("#work-area")[0];this.modalbg_div=document.createElement("div");this.modalbg_div.className="litemodalbg";$(document.body).append(this.modalbg_div);c.menubar&&(this.mainmenu=new LiteGUI.Menubar("mainmenubar"),
$(c.menubar).append(this.mainmenu.root));c.gui_callback&&c.gui_callback();!1!=c.initModules&&this.initModules();$(document).bind("keydown",function(a){"input"!=a.target.nodeName.toLowerCase()&&"textarea"!=a.target.nodeName.toLowerCase()&&17!=a.keyCode&&((26==a.keyCode||90==a.keyCode&&(a.ctrlKey||a.metaKey)||122==a.charCode&&a.ctrlKey)&&LiteGUI.doUndo(),27==a.keyCode&&$(LiteGUI).trigger("escape"))});$("#wrap").hasClass("fullscreen")&&$(window).resize(function(a){LiteGUI.maximizeWindow()})},initModules:function(){for(var c in this.modules)this.modules[c].init_gui&&
this.modules[c].init_gui();for(c in this.modules)this.modules[c].init&&!this.modules[c]._initialized&&(this.modules[c].init(),this.modules[c]._initialized=!0);this._modules_initialized=!0},registerModule:function(c){this.modules.push(c);this._modules_initialized&&(c.init_gui&&c.init_gui(),c.init&&c.init());$(this).trigger("module_registered",c)},setWindowSize:function(c,a){if(c&&a)$("#wrap").css({width:c+"px",height:a+"px","box-shadow":"0 0 4px black"}).removeClass("fullscreen");else{if($("#wrap").hasClass("fullscreen"))return;
$("#wrap").addClass("fullscreen");$("#wrap").css({width:"100%",height:"100%","box-shadow":"0 0 0"})}$(LiteGUI).trigger("resized")},maximizeWindow:function(){this.setWindowSize()},max_undo_steps:100,min_time_between_undos:500,last_undo_time:0,addUndoStep:function(c){var a=(new Date).getTime();a-this.last_undo_time<this.min_time_between_undos||(this.undo_steps.push(c),this.last_undo_time=a,this.undo_steps.length>this.max_undo_steps&&this.undo_steps.shift())},doUndo:function(){if(this.undo_steps.length){var c=
this.undo_steps.pop();null!=c.callback&&c.callback(c.data);$(LiteGUI).trigger("undo",c)}},removeUndoSteps:function(){this.undo_steps=[]},addCSS:function(c){var a=document.createElement("style");a.type="text/css";a.innerHTML=c;document.getElementsByTagName("head")[0].appendChild(a)},requireCSS:function(c,a){for("string"==typeof c&&(c=[c]);c.length;){var b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=c.shift(1);b.media="all";document.getElementsByTagName("head")[0].appendChild(b);
0==c.length&&(b.onload=a)}},requireScript:function(c,a){function b(){var e=document.createElement("script");e.type="text/javascript";e.src=c.shift(1);e.onload=function(d){c.length?b():a&&a()};document.getElementsByTagName("head")[0].appendChild(e)}"string"==typeof c&&(c=[c]);b()},showModalBackground:function(c){c?$(LiteGUI.modalbg_div).show("fade"):$(LiteGUI.modalbg_div).hide("fade")},showMessage:function(c,a){a=a||{};a.title=a.title||"Attention";a.content=c;a.close="fade";var b=new LiteGUI.Dialog("info_message",
a);a.noclose||b.addButton("Close",{close:!0});b.makeModal("fade");return b},alert:function(c,a){a=a||{};a.className="alert";a.title="Alert";a.width=280;a.height=140;"string"==typeof c&&(c="<p>"+c+"</p>");return this.showMessage(c,a)},confirm:function(c,a,b,e){a=a||{};"function"==typeof a&&(e=b,b=a,a={});a.className="alert";a.title="Confirm";a.width=280;a.height=140;"string"==typeof c&&(c="<p>"+c+"</p>");a.noclose=!0;var d=this.showMessage(c+"<button class='yes-button' style='width:45%; margin-left: 10px'>Yes</button><button class='no-button' style='width:45%'>No</button>",
a);$(d.content).find(".yes-button").click(function(){b&&b();d.close()});$(d.content).find(".no-button").click(function(){e&&e();d.close()});return d},prompt:function(c,a,b,e){a=a||{};"function"==typeof a&&(e=b,b=a,a={});a.className="alert";a.title="Prompt";a.width=280;a.height=140+(a.textarea?40:0);"string"==typeof c&&(c="<p>"+c+"</p>");var d=a.value||"",h="<input type='text' value='"+d+"'/>";a.textarea&&(h="<textarea class='textfield' style='width:95%'>"+d+"</textarea>");a.noclose=!0;var g=this.showMessage(c+
("<p>"+h+"</p><button class='yes-button' style='width:45%; margin-left: 10px'>Accept</button><button class='no-button' style='width:45%'>Cancel</button>"),a);$(g.content).find(".yes-button").click(function(){var h=$(g.content).find(a.textarea?"textarea":"input").val();b&&b(h);g.close()});$(g.content).find(".no-button").click(function(){e&&e();g.close()});return g}};
$.extend({getUrlVars:function(){for(var c=[],a,b=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<b.length;e++)a=b[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c},getUrlVar:function(c){return $.getUrlVars()[c]}});
(function(){function c(h,g){g=g||{};var a=document.createElement("div");a.className="litearea";h&&(a.id=h);this.root=a;this.root.litearea=this;this.options=g;var b=this;window.addEventListener("resize",function(h){b.resize(h)});this._computed_size=[$(this.root).width(),$(this.root).height()];a=document.createElement("div");g.content_id&&(a.id=g.content_id);a.className="liteareacontent";a.style.width="100%";a.style.height="100%";this.root.appendChild(a);this.content=a;this.split_direction="none";this.sections=
[];g.main&&$(LiteGUI).bind("resized",function(){b.resize()})}function a(h,a){a=a||{};this.width=a.width||200;this.height=a.height||100;this.content=a.content||"";var b=document.createElement("div");b.id=h;b.className="litepanel "+(a.className||"");b.data=this;var c="";a.title&&(c+="<div class='panel-header'>"+a.title+"</div><div class='buttons'>",a.minimize&&(c+="<button class='mini-button minimize-button'></button><button class='mini-button maximize-button' style='display:none'></button>"),a.hide&&
(c+="<button class='mini-button hide-button'></button>"),a.close&&(c+="<button class='mini-button close-button'></button>"),c+="</div>");c+="<div class='content'>"+this.content+"</div><div class='panel-footer'></div>";b.innerHTML=c;this.root=b;this.content=$(b).find(".content")[0];if(a.buttons)for(var f in a.buttons)this.addButton(a.buttons[f].name,a.buttons[f]);!0==a.scroll&&(this.content.style.overflow="auto");$(b).find(".close-button").bind("click",function(){b.data.close()});$(b).find(".minimize-button").bind("click",
function(){b.data.minimize()});$(b).find(".maximize-button").bind("click",function(){b.data.maximize()});$(b).find(".hide-button").bind("click",function(){b.data.hide()});this.makeDialog(a)}function b(h,a){a=a||{};var b=document.createElement("DIV");h&&(b.id=h);b.data=this;b.className="litetabs";this.root=b;this.current_tab="";a.height&&(this.root.style.height="full"==a.height?"100%":a.height);b=document.createElement("UL");b.className="wtabcontainer";this.list=b;this.root.appendChild(this.list);
this.contents={};this.selected=null;this.onchange=a.callback;a.parent&&this.appendTo(a.parent)}function e(a){this.menu=[];this.panels=[];this.root=document.createElement("div");this.root.id=a;this.root.className="litemenubar";this.content=document.createElement("ul");this.root.appendChild(this.content);this.is_open=!1}function d(a,b,c){var d=document.createElement("div");this.root=d;d.id=a;d.className="litetree";this.tree=b;this.options=c=c||{allow_rename:!0,drag:!0};a=this.createTreeItem(b,c);a.className+=
" root_item";this.root.appendChild(a);this.root_item=a}c.prototype.getSection=function(a){a=a||0;return this.sections.length>a?this.sections[a]:null};c.prototype.resize=function(a){var b=[$(this.root).width(),$(this.root).height()];if(!a||!this._computed_size||b[0]!=this._computed_size[0]||b[1]!=this._computed_size[1])if(this.sections.length)for(var c in this.sections)this.sections[c].resize(a);else for(a=0;a<this.root.childNodes.length;a++)b=this.root.childNodes[a],b.litearea?b.litearea.resize():
$(b).trigger("resize")};c.prototype.split=function(a,b,c){function d(a){$(document).bind("mousemove",f);$(document).bind("mouseup",e);s[0]=a.pageX;s[1]=a.pageY;trace("Dragging");a.stopPropagation();a.preventDefault()}function f(b){"horizontal"==a?s[0]!=b.pageX&&t.moveSplit(s[0]-b.pageX):"vertical"==a&&s[1]!=b.pageY&&t.moveSplit(s[1]-b.pageY);s[0]=b.pageX;s[1]=b.pageY;b.stopPropagation();b.preventDefault();t.options.inmediateResize&&t.resize()}function e(a){trace("Stop Dragging");$(document).unbind("mousemove",
f);$(document).unbind("mouseup",e);t.resize()}a=a||"vertical";if(this.sections.length)throw"cannot split twice";var k=new LiteGUI.Area(null,{content_id:this.content.id});k.root.style.display="inline-block";var l=new LiteGUI.Area;l.root.style.display="inline-block";var m="",v=null,w=null;c&&(m=" - 5px",v=document.createElement("div"),v.className="litesplitbar "+a,$(v).bind("mousedown",d));b=b||["50%",null];"vertical"==a?(k.root.style.width="100%",l.root.style.width="100%",null==b[0]?(k.root.style.height=
"-moz-calc( 100% - "+b[1]+m+" )",k.root.style.height="-webkit-calc( 100% - "+b[1]+m+" )",k.root.style.height="calc( 100% - "+b[1]+m+" )",l.root.style.height=b[1],l.size=b[1],w=k):null==b[1]?(k.root.style.height=b[0],k.size=b[0],l.root.style.height="-moz-calc( 100% - "+b[0]+m+" )",l.root.style.height="-webkit-calc( 100% - "+b[0]+m+" )",l.root.style.height="calc( 100% - "+b[0]+m+" )",w=l):(k.root.style.height=b[0],k.size=b[0],l.root.style.height=b[1],l.size=b[1])):(k.root.style.height="100%",l.root.style.height=
"100%",null==b[0]?(k.root.style.width="-moz-calc( 100% - "+b[1]+m+" )",k.root.style.width="-webkit-calc( 100% - "+b[1]+m+" )",k.root.style.width="calc( 100% - "+b[1]+m+" )",l.root.style.width=b[1],l.size=b[1],w=k):null==b[1]?(k.root.style.width=b[0],k.size=b[0],l.root.style.width="-moz-calc( 100% - "+b[0]+m+" )",l.root.style.width="-webkit-calc( 100% - "+b[0]+m+" )",l.root.style.width="calc( 100% - "+b[0]+m+" )",w=l):(k.root.style.width=b[0],k.size=b[0],l.root.style.width=b[1],l.size=b[1]));k.root.removeChild(k.content);
k.root.appendChild(this.content);k.content=this.content;this.root.appendChild(k.root);v&&this.root.appendChild(v);this.root.appendChild(l.root);this.sections=[k,l];this.dynamic_section=w;this.direction=a;var t=this,s=[0,0]};c.prototype.moveSplit=function(a){if(this.sections){var b=this.sections[0],c=this.sections[1];"horizontal"==this.direction?this.dynamic_section==b?(a=$(c.root).width()+a+"px",b.root.style.width="-moz-calc( 100% - "+a+" - 2px )",b.root.style.width="-webkit-calc( 100% - "+a+" - 2px )",
b.root.style.width="calc( 100% - "+a+" - 2px )",c.root.style.width=a):(a=$(b.root).width()-a+"px",b.root.style.width=a,c.root.style.width="-moz-calc( 100% - "+a+" - 2px )",c.root.style.width="-webkit-calc( 100% - "+a+" - 2px )",c.root.style.width="calc( 100% - "+a+" - 2px )"):"vertical"==this.direction&&(this.dynamic_section==b?(a=$(c.root).height()+a+"px",b.root.style.height="-moz-calc( 100% - "+a+" - 2px )",b.root.style.height="-webkit-calc( 100% - "+a+" - 2px )",b.root.style.height="calc( 100% - "+
a+" - 2px )",c.root.style.height=a):(a=$(b.root).height()+a+"px",b.root.style.height=a,c.root.style.height="-moz-calc( 100% - "+a+" - 2px )",c.root.style.height="-webkit-calc( 100% - "+a+" - 2px )",c.root.style.height="calc( 100% - "+a+" - 2px )"))}};c.prototype.setAreaSize=function(a,b){var c=this.sections[1];c.root.style.width="-moz-calc( 100% - "+b+" - 2px )";c.root.style.width="-webkit-calc( 100% - "+b+" - 2px )";c.root.style.width="calc( 100% - "+b+" - 2px )"};c.prototype.merge=function(a){if(0==
this.sections.length)throw"not splitted";a=this.sections[a||0];this.root.appendChild(a.content);this.content=a.content;this.root.removeChild(this.sections[0].root);this.root.removeChild(this.sections[1].root);this.sections=[];this._computed_size=null;this.resize()};c.prototype.hideSection=function(a){if(0==this.sections.length)throw"not splitted";};LiteGUI.Area=c;LiteGUI.Split=function(a,b,c){c=c||{};var d=document.createElement("div");this.root=d;d.id=a;d.className="litesplit "+(c.vertical?"vsplit":
"hsplit");this.sections=[];for(var f in b)a=document.createElement("div"),a.className="split-section split"+f,"number"==typeof b[f]?c.vertical?a.style.height=b[f].toFixed(1)+"%":a.style.width=b[f].toFixed(1)+"%":"string"==typeof b[f]?c.vertical?a.style.height=b[f]:a.style.width=b[f]:(b[f].id&&(a.id=b[f].id),c.vertical?a.style.height="Number"==typeof b[f].height?b[f].height.toFixed(1)+"%":b[f].height:a.style.width="Number"==typeof b[f].width?b[f].width.toFixed(1)+"%":b[f].width),this.sections.push(a),
d.appendChild(a);c.parent&&(c.parent.root?c.parent.root.appendChild(d):c.parent.appendChild(d))};a.MINIMIZED_WIDTH=200;a.title_height="20px";a.prototype.makeDialog=function(a){a=a||{};var b=this.root;b.style.position="absolute";b.style.display="none";b.style.width=this.width+"px";this.height&&(b.style.height=this.height+"px");this.height&&$(b).find(".content").css({height:this.height-20});b.style.boxShadow="0 0 3px black";a.draggable&&(this.draggable=!0,$(b).draggable({handle:".panel-header"}));$(LiteGUI.root_container).append(this.root);
this.center()};a.prototype.dockTo=function(a,b){if(a){var c=this.root;c.style.top=0;c.style.left=0;c.style.boxShadow="0 0 0";if("full"==b)c.style.position="relative",c.style.width="100%",c.style.height="100%",this.content.style.width="100%",this.content.style.height="calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="-moz-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="-webkit-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.overflow="auto";
else if("left"==b||"right"==b)c.style.position="absolute",c.style.top=0,c.style[b]=0,c.style.width=this.width+"px",c.style.height="100%",this.content.style.height="-moz-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="-webkit-calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.height="calc(100% - "+LiteGUI.Panel.title_height+")",this.content.style.overflow="auto","right"==b&&(c.style.left="auto",c.style.right=0);else if("bottom"==b||"top"==b)c.style.width="100%",
c.style.height=this.height+"px","bottom"==b&&(c.style.bottom=0,c.style.top="auto");this.draggable&&$(c).draggable({disabled:!0});a.content?a.content.appendChild(c):"string"==typeof a?$(a).append(c):a.appendChild(c)}};a.prototype.addButton=function(a,b){var c=this,d=document.createElement("button");d.innerHTML=a;b.className&&(d.className=b.className);$(this.root).find(".panel-footer").append(d);$(d).bind("click",function(){b.callback&&b.callback();b.close&&c.close()});return d};a.prototype.close=function(a){$(this).trigger("closed");
a?$(this.root).hide("fade",null,function(){trace("Panel closed");$(this).remove()}):(trace("Panel closed"),$(this.root).remove())};a.minimized=[];a.prototype.minimize=function(){this.minimized||(this.minimized=!0,this.old_pos=$(this.root).position(),$(this.root).find(".content").hide(),$(this.root).draggable({disabled:!0}),$(this.root).find(".minimize-button").hide(),$(this.root).find(".maximize-button").show(),$(this.root).css({width:LiteGUI.Panel.MINIMIZED_WIDTH}),$(this).bind("closed",function(){LiteGUI.Panel.minimized.splice(LiteGUI.Panel.minimized.indexOf(this),
1);LiteGUI.Panel.arrangeMinimized()}),LiteGUI.Panel.minimized.push(this),LiteGUI.Panel.arrangeMinimized(),$(this).trigger("minimizing"))};a.arrangeMinimized=function(){var a=$(LiteGUI.root_container).height()-20,b;for(b in LiteGUI.Panel.minimized)$(LiteGUI.Panel.minimized[b].root).animate({left:LiteGUI.Panel.MINIMIZED_WIDTH*b,top:a+"px"},100)};a.prototype.maximize=function(){this.minimized&&(this.minimized=!1,$(this.root).find(".content").show(),$(this.root).draggable({disabled:!1}),$(this.root).animate({left:this.old_pos.left+
"px",top:this.old_pos.top+"px",width:this.width},100),$(this.root).find(".minimize-button").show(),$(this.root).find(".maximize-button").hide(),LiteGUI.Panel.minimized.splice(LiteGUI.Panel.minimized.indexOf(this),1),LiteGUI.Panel.arrangeMinimized(),$(this).trigger("maximizing"))};a.prototype.makeModal=function(){LiteGUI.showModalBackground(!0);$(LiteGUI.modalbg_div).append(this.root);$(this.root).draggable({disabled:!0});this.show();this.center();$(this).bind("closed",function(a){trace("closing");
LiteGUI.showModalBackground(!1)})};a.prototype.bringToFront=function(){var a=$(this.root).parent();a.detach(this.root);a.attach(this.root)};a.prototype.show=function(a,b){$(this.root).show(a,null,100,b);$(this).trigger("shown")};a.prototype.hide=function(a,b){$(this.root).hide(a,null,100,b);$(this).trigger("hidden")};a.prototype.setPosition=function(a,b){this.root.position="absolute";this.root.style.left=a+"px";this.root.style.top=b+"px"};a.prototype.center=function(){this.root.position="absolute";
this.root.style.left=Math.floor(0.5*($(this.root.parentNode).width()-$(this.root).width()))+"px";this.root.style.top=Math.floor(0.5*($(this.root.parentNode).height()-$(this.root).height()))+"px"};LiteGUI.Panel=a;LiteGUI.Dialog=a;b.tabs_height="30px";b.prototype.appendTo=function(a,b){b?$(a).prepend(this.root):$(a).append(this.root)};b.prototype.get=function(a){return this.contents[a]};b.prototype.add=function(a,b){b=b||{};var c=this,d=document.createElement("LI");d.className="wtab wtab-"+a.replace(/ /gi,
"_");d.data=a;d.innerHTML=a;$(this.list).append(d);var f=document.createElement("div");b.id&&(f.id=b.id);f.className="wtabcontent wtabcontent-"+a+" "+(b.className||"");f.data=a;f.style.display="none";b.height&&(f.style.overflow="auto","full"==b.height?(f.style.height="calc( 100% - "+LiteGUI.Tabs.tabs_height+" )",f.style.height="-moz-calc( 100% - "+LiteGUI.Tabs.tabs_height+" )",f.style.height="-webkit-calc( 100% - "+LiteGUI.Tabs.tabs_height+" )"):f.style.height=b.height);b.content&&("string"==typeof b.content?
f.innerHTML=b.content:f.appendChild(b.content));$(this.root).append(f);this.contents[a]=f;$(d).click(function(f){if(!$(this).hasClass("selected")){f=this.data;var d=null,e;for(e in c.contents)e==f?($(c.contents[e]).show(),d=c.contents[e]):$(c.contents[e]).hide();$(c.list).find("li.wtab").removeClass("selected");$(this).addClass("selected");c.current_tab&&c.current_tab[0]!=f&&c.current_tab[2]&&c.current_tab[2].callback_leave&&c.current_tab[2].callback_leave(c.current_tab[0],c.current_tab[1],c.current_tab[2]);
c.current_tab=[f,d,b];b.callback&&b.callback(f,d);$(c).trigger("wchange",[f,d]);if(c.onchange)c.onchange(a,f,d);c.selected=a}});this.list.appendChild(d);!0!=b.selected&&null!=this.selected||this.select(a);return $(d)};b.prototype.select=function(a){for(var b=$(this.list).find("li.wtab"),c=0;c<b.length;c++)if(a==b[c].data){$(b[c]).click();break}};LiteGUI.Tabs=b;e.closing_time=500;e.prototype.clear=function(){$(this.content).empty();this.menu=[];this.panels=[]};e.prototype.attachToPanel=function(a){$(a.content).prepend(this.root)};
e.prototype.add=function(a,b){b=b||{};for(var c=this.menu.length,d=a.split("/"),f=0,e=0,k=this.menu;k;)if(k.length==e){e={children:[]};f==d.length-1&&(e.data=b);e.disable=function(){this.data&&(this.data.disabled=!0)};e.enable=function(){this.data&&delete this.data.disabled};e.name=d[f];k.push(e);f++;if(f==d.length)break;e.children=[];k=e.children;e=0}else{if(k[e]&&d[f]==k[e].name)if(f<d.length){k=k[e].children;e=0;f++;continue}else{trace("Warning: Adding menu that already exists: "+a);break}e++}c!=
this.menu.length&&this.updateMenu()};e.prototype.separator=function(a,b){var c=this.findMenu(a);c&&c.push({separator:!0,order:b||10})};e.prototype.findMenu=function(a){a=a.split("/");for(var b=0,c=0,d=this.menu;d;){if(b==a.length)return d;if(d.length<=c)break;if("*"==a[b])return d[c].children;if(a[b]==d[c].name)if(b<a.length){d=d[c].children;c=0;b++;continue}else return d[c];c++}return null};e.prototype.updateMenu=function(){var a=this;$(this.content).empty();for(var b in this.menu){var c=document.createElement("li");
c.innerHTML="<span class='icon'></span><span class='name'>"+this.menu[b].name+"</span>";this.content.appendChild(c);c.data=this.menu[b];this.menu[b].element=c;$(c).bind("click",function(b){var c=this.data;c.data&&c.data.callback&&"function"==typeof c.data.callback&&c.data.callback(c.data);a.is_open?(a.is_open=!1,a.hidePanels()):(a.is_open=!0,a.showMenu(c,b,this))});$(c).bind("mouseover",function(b){a.hidePanels();a.is_open&&a.showMenu(this.data,b,this)})}};e.prototype.hidePanels=function(){if(this.panels.length){for(var a in this.panels)$(this.panels[a]).remove();
this.panels=[]}};e.prototype.showMenu=function(a,b,c,d){d||this.hidePanels();if(a.children&&a.children.length){var f=this;f.closing_by_leave&&clearInterval(f.closing_by_leave);var e=document.createElement("div");e.className="litemenubar-panel";var k=[],l;for(l in a.children)k.push(a.children[l]);k.sort(function(a,b){var c=10,f=10;a&&a.data&&null!=a.data.order&&(c=a.data.order);a&&a.separator&&null!=a.order&&(c=a.order);b&&b.data&&null!=b.data.order&&(f=b.data.order);b&&b.separator&&null!=b.order&&
(f=b.order);return c-f});for(l in k){a=document.createElement("p");var m=k[l];a.className="litemenu-entry "+(a.children?" submenu":"");a.innerHTML=m&&m.name?"<span class='icon'></span><span class='name'>"+m.name+(m.children&&m.children.length?"<span class='more'>+</span>":"")+"</span>":"<span class='separator'></span>";a.data=m;if(a.data.data){m=a.data.data;if("checkbox"==m.type&&m.instance&&m.property&&!0==m.instance[m.property]||!0==m.checkbox||m.instance&&m.property&&m.hasOwnProperty("value")&&
m.instance[m.property]==m.value||"function"==typeof m.isChecked&&m.isChecked.call(m.instance,m))a.className+=" checked";m.disabled&&(a.className+=" disabled")}$(a).bind("click",function(){var a=this.data;if(a.data){if(a.data.disabled)return;a.data.instance&&a.data.property&&("checkbox"==a.data.type?(a.data.instance[a.data.property]=!a.data.instance[a.data.property],a.data.instance[a.data.property]?$(this).addClass("checked"):$(this).removeClass("checked")):a.data.hasOwnProperty("value")&&(a.data.instance[a.data.property]=
a.data.value));null!=a.data.checkbox&&(a.data.checkbox=!a.data.checkbox,a.data.checkbox?$(this).addClass("checked"):$(this).removeClass("checked"));a.data.callback&&"function"==typeof a.data.callback&&a.data.callback(a.data)}a.children&&a.children.length?f.showMenu(a,b,this,!0):(f.is_open=!1,f.hidePanels())});$(e).append(a)}$(e).bind("mouseleave",function(a){f.closing_by_leave&&clearInterval(f.closing_by_leave);f.closing_by_leave=setTimeout(function(){f.is_open=!1;f.hidePanels()},LiteMenubar.closing_time)});
$(e).bind("mouseenter",function(a){f.closing_by_leave&&clearInterval(f.closing_by_leave);f.closing_by_leave=null});c=$(c);e.style.left=c.offset().left+(d?200:0)+"px";e.style.top=c.offset().top+c.height()+(d?-20:2)+"px";this.panels.push(e);$(document.body).append(e);$(e).hide().show()}};LiteGUI.Menubar=e;LiteGUI.ContextualMenu=function(a,b){this.options=b=b||{};var c=this,d=document.createElement("div");d.className="litecontextualmenu litemenubar-panel";d.style.minWidth=100;d.style.minHeight=100;this.root=
d;for(var f in a){var e=document.createElement("div");e.className="litemenu-entry submenu";e.dataset.value=a[f];e.innerHTML=a.constructor==Array?a[f]:f;d.appendChild(e)}$(d).find(".litemenu-entry").click(function(a){a=this.dataset.value;b.callback&&b.callback.call(c,a);document.body.removeChild(d)});$(d).mouseleave(function(a){document.body.removeChild(d)});document.body.appendChild(d);f=b.left||0;e=b.top||0;if(b.event){f=b.event.pageX-10;var e=b.event.pageY-10,k=document.body.getClientRects()[0];
f>k.width-$(d).width()-10&&(f=k.width-$(d).width()-10);e>k.height-$(d).height()-10&&(e=k.height-$(d).height()-10)}d.style.left=f+"px";d.style.top=e+"px"};d.prototype.updateTree=function(a){this.root_item&&$(this.root_item).remove();a&&(a=this.createTreeItem(a,this.options),a.className+=" root_item",this.root.appendChild(a),this.root_item=a)};d.prototype.createTreeItem=function(a,b){var c=document.createElement("li");c.className="ltreeitem";a.id&&(c.id=a.id);c.data=a;a.DOM=c;b=b||this.options;var d=
document.createElement("div");d.className="ltreecontent";d.innerHTML=a.content||a.id||"";c.appendChild(d);c.content_element=d;$(c).find(".ltreecontent").click(function(a){this._editing||($(l.root).removeClass("selected"),$(l.root).find(".ltreecontent.selected").removeClass("selected"),$(this).addClass("selected"),a=this.parentNode,$(l).trigger("item_selected",[a.data,a]),a.callback&&a.callback.call(l,a))});$(c).find(".ltreecontent").dblclick(function(a){var b=this.parentNode;$(l).trigger("item_dblclicked",
[b.data,b]);if(!this._editing&&l.options.allow_rename){this._editing=!0;this._old_name=this.innerHTML;var c=this;this.innerHTML="<input type='text' value='"+this.innerHTML+"' />";var d=$(this).find("input")[0];$(d).blur(function(a){c.innerHTML=a.target.value;delete c._editing;$(l).trigger("item_renamed",[c._old_name,a.target.value,b]);delete c._old_name});$(d).bind("keydown",function(a){13==a.keyCode&&$(this).blur()});$(d).focus();a.preventDefault()}});var f=document.createElement("ul");f.className=
"ltreelist";c.list=f;if(a.children)for(var e in a.children){var k=this.createTreeItem(a.children[e],b);f.appendChild(k)}c.appendChild(f);var l=this;d.draggable=!0;d.addEventListener("dragstart",function(a){a.dataTransfer.setData("node-id",this.parentNode.id)});d.addEventListener("dragenter",function(a){a.preventDefault()});d.addEventListener("dragover",function(a){a.preventDefault()});d.addEventListener("drop",function(a){a.preventDefault();var b=a.dataTransfer.getData("node-id");if(""!=b)try{l.moveItem(b,
this.parentNode.id)&&$(l).trigger("item_moved",[l.getItem(b),l.getItem(this.parentNode.id)])}catch(c){trace("Error: "+c)}else $(l).trigger("drop_on_item",[this,a])});return c};d.prototype.getItem=function(a){a=$(this.root).find("#"+a);if(!a.length)return null;if(!$(a).hasClass("ltreeitem"))throw"this node is not a tree item";return a[0]};d.prototype.setSelectedItem=function(a){if(a){a=this.getItem(a);if(!a)return null;if($(a).hasClass("selected"))return a;$(this.root).removeClass("selected");$(this.root).find(".ltreecontent.selected").removeClass("selected");
$(a.content_element).addClass("selected");return a}$(this.root).removeClass("selected");$(this.root).find(".ltreecontent.selected").removeClass("selected")};d.prototype.getSelectedItem=function(){var a=$(that.root).find(".ltreecontent.selected");return a.length?a[0]:null};d.prototype.insertItem=function(a,b,c,d){var f=this.root_item;if(b&&(f="string"==typeof b?this.getItem(b):b,!f))return null;if(!$(f).hasClass("ltreeitem"))throw"this node is not a tree item";a=this.createTreeItem(a,d);void 0==c?
f.list.appendChild(a):(trace(f.list.childNodes),f.list.insertBefore(a,f.list.childNodes[c]));return a};d.prototype.moveItem=function(a,b){var c=this.getItem(b),d=this.getItem(a);if(!c||!d)return!1;c.list.appendChild(d);return!0};d.prototype.removeItem=function(a){(a=this.getItem(a))&&$(a).remove()};d.prototype.updateItem=function(a,b){var c=this.getItem(a);c&&(c.data=b,b.id&&(c.id=b.id),b.content&&(c.content_element.innerHTML=b.content))};d.prototype.clear=function(a){$(a?this.root_item:this.root).find(".ltreeitem").remove()};
LiteGUI.Tree=d;LiteGUI.List=function(a,b,c){c=c||{};var d=document.createElement("ul");this.root=d;d.id=a;d.className="litelist";this.items=[];var f=this;this.callback=c.callback;for(var e in b){a=document.createElement("li");a.className="list-item";a.data=b[e];var k="";"string"==typeof b[e]?k=b[e]+"<span class='arrow'></span>":(k=(b[e].name||b[e].title||"")+"<span class='arrow'></span>",b[e].id&&(a.id=b[e].id));a.innerHTML=k;d.appendChild(a)}$(d).find(".list-item").click(function(){$(d).find(".list-item.selected").removeClass("selected");
$(this).addClass("selected");$(f).trigger("wchanged",this);f.callback&&f.callback(this.data)});c.parent&&(c.parent.root?$(c.parent.root).append(d):$(c.parent).append(d))}})();jQuery.fn.wchange=function(c){$(this[0]).bind("wchange",c)};jQuery.fn.wclick=function(c){$(this[0]).bind("wclick",c)};
function Inspector(c,a){a=a||{};this.root=document.createElement("DIV");this.root.className="inspector "+(a.full?"full":"");a.one_line&&(this.root.className+=" one-line");c&&(this.root.id=c);this.values={};this.sections=[];this.widgets={};this.addSection();this.tab_index=Math.floor(1E4*Math.random());a.name_width&&(this.widget_name_width=a.name_width);a.parent&&this.appendTo(a.parent);this.widgets_per_row=a.widgets_per_row||1}Inspector.prototype.appendTo=function(c,a){a?$(c).prepend(this.root):$(c).append(this.root)};
Inspector.prototype.clear=function(){$(this.root).empty();this.sections=[];this.values={};this.widgets={};this.addSection()};Inspector.prototype.append=function(c){var a=this.root;this.current_group_content?a=this.current_group_content:this.current_section_content&&(a=this.current_section_content);a.appendChild(c)};Inspector.prototype.setup=function(c){for(var a in c){var b=c[a];this.add(b.type,b.name,b.value,b.options)}};
Inspector.prototype.createWidget=function(c,a,b){b=b||{};a=a||"";var e=document.createElement("DIV");e.className="widget "+(b.className||"");e.inspector=this;e.options=b;e.name=c;b.width&&(e.style.width="string"==typeof b.width?b.width:b.width+"px",e.style.minWidth=e.style.width);c&&(this.widgets[c]=e);1!=this.widgets_per_row&&(b.width||(e.style.width=(100/this.widgets_per_row).toFixed(2)+"%"),e.style.display="inline-block");var d="",h="";if(this.widget_name_width||b.widget_name_width)h=this.widget_name_width||
b.widget_name_width,"number"==typeof h&&(h=h.toFixed()+"px"),d="style='width: calc("+h+" - 0px); width: -webkit-calc("+h+" - 0px); width: -moz-calc("+h+" - 0px); '",h="style='width: calc( 100% - "+h+"); width: -webkit-calc(100% - "+h+"); width: -moz-calc( 100% - "+h+"); '";b="";var g="wcontent ";null==c?g+=" full":b=""==c?"<span class='wname' title='"+c+"' "+d+"></span>":"<span class='wname' title='"+c+"' "+d+">"+c+"<span class='filling'>....................</span> </span>";"string"==typeof a?e.innerHTML=
b+"<span class='info_content "+g+"' "+h+">"+a+"</span>":(e.innerHTML=b+"<span class='info_content "+g+"' "+h+"></span>",$(e).find("span.info_content").append(a));return e};Inspector.onWidgetChange=function(c,a,b,e){this.values[a]=b;$(this.current_section).trigger("wchange",b);e.callback&&e.callback.call(c,b);$(c).trigger("wchange",b);if(this.onchange)this.onchange(a,b,c)};
Inspector.widget_constructors={title:"addTitle",info:"addInfo",number:"addNumber",slider:"addSlider",string:"addString",text:"addString",textarea:"addTextarea",slider:"addSlider",color:"addColor",checkbox:"addCheckbox",vector2:"addVector2",vector3:"addVector3",combo:"addCombo",button:"addButton",buttons:"addButtons",file:"addFile",line:"addLine",list:"addList",separator:"addSeparator"};
Inspector.prototype.add=function(c,a,b,e){"object"==typeof c&&1==arguments.length&&(e=c,c=e.type,a=e.name,b=e.value);var d=Inspector.widget_constructors[c];if(d&&("string"==typeof d&&(d=Inspector.prototype[d]),d&&"function"==typeof d))return"function"==typeof e&&(e={callback:e}),d.call(this,a,b,e)};Inspector.prototype.getValue=function(c){return this.values[c]};Inspector.prototype.set=function(c,a){};
Inspector.prototype.addSection=function(c,a){a=a||{};this.current_group&&this.endGroup();var b=document.createElement("DIV");b.className="wsection";c||(b.className+=" notitle");var e="";c&&(e+="<div class='wsectiontitle'>"+(a.no_minimize?"":"<span class='switch-section-button'></span>")+c+"</div>");b.innerHTML=e+"<div class='wsectioncontent'></div>";this.root.appendChild(b);c&&$(b).find(".wsectiontitle").click(function(a){"button"!=a.target.localName&&($(b).toggleClass("minimized"),$(b).find(".wsectioncontent").toggle())});
this.current_section=b;this.content=this.current_section_content=$(b).find(".wsectioncontent")[0];a.widgets_per_row&&(this.widgets_per_row=a.widgets_per_row);return b};
Inspector.prototype.beginGroup=function(c,a){a=a||{};this.current_group&&this.endGroup();var b=document.createElement("DIV");b.className="wgroup";b.innerHTML="<div class='wgroupheader "+(a.title?"wtitle":"")+"'><span class='wgrouptoggle'>-</span>"+c+"</div>";var e=document.createElement("DIV");e.className="wgroupcontent";a.collapsed&&(e.style.display="none");b.appendChild(e);var d=a.collapsed||!1;$(b).find(".wgroupheader").click(function(){$(b).find(".wgroupcontent").toggle();d=!d;$(b).find(".wgrouptoggle").html(d?
"+":"-")});this.append(b);this.current_group=b;this.content=this.current_group_content=e;return b};Inspector.prototype.endGroup=function(c){this.current_group_content=this.current_group=null;this.content=this.current_section_content};
Inspector.prototype.addTitle=function(c,a){a=a||{};var b=document.createElement("DIV"),e="<span class='wtitle'><span class='text'>"+c+"</span>";a.help&&(e+="<span class='help'><div class='help-content'>"+a.help+"</div></span>");b.innerHTML=e+"</span>";b.setValue=function(a){$(this).find(".text").html(a)};this.append(b);return b};Inspector.prototype.addSeparator=function(){var c=document.createElement("DIV");c.className="separator";this.append(c);return c};
Inspector.prototype.addString=function(c,a,b){b=b||{};a=a||"";var e=this;this.values[c]=a;var d="text";b.password&&(d="password");var h=this.createWidget(c,"<span class='inputfield full "+(b.disabled?"disabled":"")+"'><input type='"+d+"' tabIndex='"+this.tab_index+"' class='text string' value='"+a+"' "+(b.disabled?"disabled":"")+"/></span>",b);$(h).find(".wcontent input").change(function(a){Inspector.onWidgetChange.call(e,h,c,a.target.value,b)});this.tab_index+=1;h.setValue=function(a){$(this).find("input").val(a).change()};
h.wchange=function(a){$(this).wchange(a)};this.append(h);return h};
Inspector.prototype.addStringButton=function(c,a,b){b=b||{};a=a||"";var e=this;this.values[c]=a;var d=this.createWidget(c,"<span class='inputfield button'><input type='text' tabIndex='"+this.tab_index+"' class='text string' value='"+a+"' "+(b.disabled?"disabled":"")+"/></span><button class='micro'>"+(b.button||"...")+"</button>",b);$(d).find(".wcontent input").change(function(a){Inspector.onWidgetChange.call(e,d,c,a.target.value,b)});$(d).find(".wcontent button").click(function(a){b.callback_button&&
b.callback_button.call(d,$(d).find(".wcontent input").val())});this.tab_index+=1;this.append(d);d.wchange=function(a){$(this).wchange(a)};d.wclick=function(a){$(this).wclick(a)};return d};
Inspector.prototype.addNumber=function(c,a,b){b=b||{step:0.1};a=a||0;var e=this;this.values[c]=a;var d=this.createWidget(c,"",b);this.append(d);b.extraclass="full";b.tab_index=this.tab_index;b.dragger_class="full";this.tab_index++;a=new LiteDragger(a,b);$(d).find(".wcontent").append(a.root);$(a).bind("start_dragging",function(a){b.callback_before&&b.callback_before.call(d)});$(d).find("input").change(function(a){e.values[c]=a.target.value;if(b.callback){var g=b.callback.call(d,parseFloat(a.target.value));
"number"==typeof g&&$(this).val(g)}$(d).trigger("wchange",a.target.value);if(e.onchange)e.onchange(c,a.target.value,d)});d.setValue=function(a){$(this).find("input").val(a).change()};return d};
Inspector.prototype.addVector2=function(c,a,b){function e(a){b.callback_before&&b.callback_before()}b=b||{step:0.1};a=a||[0,0];var d=this;this.values[c]=a;var h=this.createWidget(c,"",b);b.step=b.step||0.1;b.dragger_class="medium";b.tab_index=this.tab_index;this.tab_index++;var g=new LiteDragger(a[0],b);g.root.style.marginLeft=0;$(h).find(".wcontent").append(g.root);b.tab_index=this.tab_index;this.tab_index++;a=new LiteDragger(a[1],b);$(h).find(".wcontent").append(a.root);$(g).bind("start_dragging",
e);$(a).bind("start_dragging",e);$(h).find("input").change(function(a){a=[];for(var e=$(h).find("input"),f=0;f<e.length;f++)a.push(parseFloat(e[f].value));d.values[c]=a;if(b.callback){var g=b.callback.call(h,a);if("object"==typeof g&&2<=g.length){for(f=0;f<e.length;f++)$(e[f]).val(g[f]);a=g}}$(h).trigger("wchange",[a]);if(d.onchange)d.onchange(c,a,h)});this.append(h);return h};
Inspector.prototype.addVector3=function(c,a,b){function e(a){b.callback_before&&b.callback_before()}b=b||{step:0.1};a=a||[0,0,0];var d=this;this.values[c]=a;var h=this.createWidget(c,"",b);b.step=b.step||0.1;b.dragger_class="mini";b.tab_index=this.tab_index;this.tab_index++;var g=new LiteDragger(a[0],b);g.root.style.marginLeft=0;$(h).find(".wcontent").append(g.root);b.tab_index=this.tab_index;this.tab_index++;var n=new LiteDragger(a[1],b);$(h).find(".wcontent").append(n.root);b.tab_index=this.tab_index;
this.tab_index++;a=new LiteDragger(a[2],b);$(h).find(".wcontent").append(a.root);$(g).bind("start_dragging",e);$(n).bind("start_dragging",e);$(a).bind("start_dragging",e);$(h).find("input").change(function(a){a=[];for(var f=$(h).find("input"),e=0;e<f.length;e++)a.push(parseFloat(f[e].value));d.values[c]=a;if(b.callback){var g=b.callback.call(h,a);if("object"==typeof g&&3<=g.length){for(e=0;e<f.length;e++)$(f[e]).val(g[e]);a=g}}$(h).trigger("wchange",[a]);if(d.onchange)d.onchange(c,a,h)});this.append(h);
return h};
Inspector.prototype.addTextarea=function(c,a,b){b=b||{};a=a||"";var e=this;this.values[c]=a;var d=this.createWidget(c,"<span class='inputfield textarea "+(b.disabled?"disabled":"")+"'><textarea tabIndex='"+this.tab_index+"' "+(b.disabled?"disabled":"")+">"+a+"</textarea></span>",b);this.tab_index++;$(d).find(".wcontent textarea").bind(b.inmediate?"keyup":"change",function(a){Inspector.onWidgetChange.call(e,d,c,a.target.value,b)});b.height&&$(d).find("textarea").css({height:b.height});this.append(d);d.setValue=
function(a){$(this).find("textarea").val(a).change()};return d};Inspector.prototype.addInfo=function(c,a,b){b=b||{};a=a||"";var e=null;null!=c?e=this.createWidget(c,a,b):(e=document.createElement("div"),e.className=b.className,e.innerHTML="<span class='winfo'>"+a+"</span>");e.setValue=function(a){$(this).find(".winfo").html(a)};b.height&&(c=$(e).find("span.info_content")[0],c.style.height="string"==typeof b.height?b.height:b.height+"px",c.style.overflow="auto");this.append(e);return e};
Inspector.prototype.addSlider=function(c,a,b){b=b||{};b.min=b.min||0;b.max=b.max||1;b.step=b.step||0.01;var e=this;this.values[c]=a;var d=this.createWidget(c,"<span class='inputfield'>\t\t\t\t<input tabIndex='"+this.tab_index+"' type='text' class='slider-text fixed nano' value='"+a+"' /></span>\t\t\t\t<span class='ui-slider'>\t\t\t\t<input class='slider-input' type='range' step='"+b.step+"' min='"+b.min+"' max='"+b.max+"'/><span class='slider-thumb'></span></span>",b);this.tab_index++;var h=$(d).find(".ui-slider");
$(d).find(".slider-input").bind("input",function(a){a=parseFloat(a.target.value);var h=(a-b.min)/(b.max-b.min);$(d).find(".slider-text").val(a);$(d).find(".slider-thumb").css({left:(90*h).toFixed(2)+"%"});Inspector.onWidgetChange.call(e,d,c,a,b)});$(d).find(".slider-text").bind("change",function(){var a=parseFloat($(this).val());$(d).find(".slider-input").val(a);var n=(a-b.min)/(b.max-b.min);$(d).find(".slider-thumb").css({left:n*($(h).width()-12)});Inspector.onWidgetChange.call(e,d,c,a,b)});this.append(d);
d.setValue=function(a){$(this).find(".slider-text").val(a)};$(d).find(".slider-input").val(a).trigger("input");return d};
Inspector.prototype.addCheckbox=function(c,a,b){b=b||{};a=a||"";var e=this;this.values[c]=a;var d=this.createWidget(c,"<span class='inputfield'><span tabIndex='"+this.tab_index+"' class='fixed flag checkbox "+(a?"on":"off")+"'>"+(a?"on":"off")+"</span></span>",b);this.tab_index++;$(d).find(".wcontent .checkbox").keypress(function(a){32==a.keyCode&&$(this).click()});$(d).click(function(){var a=!this.data;this.data=a;$(d).find("span.flag").html(a?"on":"off");a?$(d).find("span.checkbox").addClass("on"):
$(d).find("span.checkbox").removeClass("on");Inspector.onWidgetChange.call(e,d,c,a,b)})[0].data=a;d.setValue=function(a){e.values[c]!=a&&$(this).find(".checkbox").click()};this.append(d);return d};Inspector.prototype.addFlags=function(c,a){var b={},e;for(e in c)b[e]=c[e];if(a)for(e in a)"undefined"==typeof b[e]&&(b[e]=a[e]?!0:!1);for(e in b)this.addCheckbox(e,b[e],{callback:function(a){return function(b){c[a]=b}}(e)})};
Inspector.prototype.addCombo=function(c,a,b){b=b||{};var e=this;this.values[c]=a;var d="<select tabIndex='"+this.tab_index+"' "+(b.disabled?"disabled":"")+" class='"+(b.disabled?"disabled":"")+"'>";this.tab_index++;if(b.values)for(var h in b.values)d+="<option "+(b.values[h]==a?" selected":"")+">"+(b.values.length?b.values[h]:h)+"</option>";var g=this.createWidget(c,"<span class='inputfield full inputcombo "+(b.disabled?"disabled":"")+"'>"+(d+"</select>")+"</span>",b);$(g).find(".wcontent select").change(function(a){a=
a.target.value;b.values&&b.values.constructor!=Array&&(a=b.values[a]);Inspector.onWidgetChange.call(e,g,c,a,b)});this.append(g);return g};
Inspector.prototype.addComboButtons=function(c,a,b){b=b||{};a=a||"";var e=this;this.values[c]=a;var d="";if(b.values)for(var h in b.values)d+="<button class='wcombobutton "+(a==b.values[h]?"selected":"")+"' data-name='options.values[i]'>"+b.values[h]+"</button>";var g=this.createWidget(c,d,b);$(g).find(".wcontent button").click(function(a){a=a.target.innerHTML;e.values[c]=a;$(g).find(".selected").removeClass("selected");$(this).addClass("selected");Inspector.onWidgetChange.call(e,g,c,a,b)});this.append(g);
return g};
Inspector.prototype.addTags=function(c,a,b){function e(a){if(!g.tags[a]){g.tags[a]=!0;var e=document.createElement("div");e.data=a;e.className="wtag";e.innerHTML=a+"<span class='close'>X</span>";$(e).find(".close").click(function(a){a=$(this).parent()[0].data;delete g.tags[a];$(this).parent().remove();$(g).trigger("wremoved",a);Inspector.onWidgetChange.call(d,g,c,g.tags,b)});$(g).find(".wtagscontainer").append(e);d.values[c]=g.tags;b.callback&&b.callback.call(g,g.tags);$(g).trigger("wchange",g.tags);
$(g).trigger("wadded",a);if(d.onchange)d.onchange(c,g.tags,g)}}b=b||{};a=a||[];var d=this;this.values[c]=a;a="<select>";if(b.values)for(var h in b.values)a+="<option>"+b.values[h]+"</option>";var g=this.createWidget(c,"<span class='inputfield full'>"+(a+"</select><div class='wtagscontainer inputfield'></div>")+"</span>",b);g.tags={};for(h in b.value)e(b.value[h]);$(g).find(".wcontent select").change(function(a){e(a.target.value)});this.append(g);return g};
Inspector.prototype.addList=function(c,a,b){function e(a){var b=$(n).find("li.selected");b&&b.length&&(40==a.keyCode?(a=b.next())&&a.length&&$(a[0]).click():38==a.keyCode&&(a=b.prev())&&a.length&&$(a[0]).click())}function d(d){b.multiselection?$(this).toggleClass("selected"):($(n).find("li").removeClass("selected"),$(this).addClass("selected"));d=a[this.dataset.pos];Inspector.onWidgetChange.call(h,n,c,d,b);$(n).trigger("wadded",d)}b=b||{};var h=this,g="";b.height&&(g="style='height: "+b.height+"px; overflow: auto;'");
g="<ul class='lite-list' "+g+" tabIndex='"+this.tab_index+"'><ul>";this.tab_index++;var n=this.createWidget(c,"<span class='inputfield full "+(b.disabled?"disabled":"")+"'>"+g+"</span>",b);$(n).find("ul").focus(function(){$(document).bind("keypress",e)});$(n).find("ul").blur(function(){$(document).unbind("keypress",e)});n.updateItems=function(b){var c="";if(a=b)for(var e in a){b=a[e];var g="";null==a[e].length&&(b=a[e].name?a[e].name:e,a[e].icon&&(g="<img src='"+a[e].icon+"' class='icon' />"));c+=
"<li className='item-"+e+" "+("object"==typeof a[e]&&a[e].selected?"selected":"")+"' data-name='"+b+"' data-pos='"+e+"'>"+g+b+"</li>"}$(this).find("ul").html(c);$(this).find(".wcontent li").click(d)};n.removeItem=function(a){for(var b=$(n).find(".wcontent li"),c=0;c<b.length;c++)b[c].dataset.name==a&&$(b[c]).remove()};n.updateItems(a);this.append(n);b.height&&$(n).scroll(0);return n};
Inspector.prototype.addButton=function(c,a,b){b=b||{};a=a||"";var e=this,d=this.createWidget(c,"<button tabIndex='"+this.tab_index+"'>"+a+"</button>",b);this.tab_index++;$(d).find("button").click(function(){Inspector.onWidgetChange.call(e,d,c,this.innerHTML,b);$(d).trigger("wclick",a)});this.append(d);d.wclick=function(a){$(this).wclick(a)};return d};
Inspector.prototype.addButtons=function(c,a,b){b=b||{};a=a||"";var e=this,d="",h="calc("+(100/a.length).toFixed(3)+"% - "+Math.floor(16/a.length)+"px);";if(a&&"object"==typeof a)for(var g in a)d+="<button tabIndex='"+this.tab_index+"' style=' width:"+h+" width: -moz-"+h+" width: -webkit-calc("+(89/a.length).toFixed(3)+"%)'>"+a[g]+"</button>",this.tab_index++;var n=this.createWidget(c,d,b);$(n).find("button").click(function(){Inspector.onWidgetChange.call(e,n,c,this.innerHTML,b);$(n).trigger("wclick",
this.innerHTML)});this.append(n);return n};
Inspector.prototype.addColor=function(c,a,b){b=b||{};a=a||[0,0,0];var e=this;this.values[c]=a;var d="<input tabIndex='"+this.tab_index+"' id='colorpicker-"+c+"' class='color' value='"+a+"' "+(b.disabled?"disabled":"")+"/>";this.tab_index++;b.show_rgb&&(d+="<span class='rgb-color'>"+Inspector.parseColor(a)+"</span>");var h=this.createWidget(c,d,b);this.append(h);var d=$(h).find("input.color")[0],g=new jscolor.color(d);g.pickerFaceColor="#333";g.pickerBorderColor="black";g.pickerInsetColor="#222";g.rgb_intensity=
1;b.disabled&&(g.pickerOnfocus=!1);"string"!=typeof a&&a.length&&2<a.length&&(g.fromRGB(1*a[0],1*a[1],1*a[2]),g.rgb_intensity=1);$(d).change(function(a){$(h).find(".rgb-color").html(Inspector.parseColor(g.rgb))});g.onImmediateChange=function(){var a=[g.rgb[0]*g.rgb_intensity,g.rgb[1]*g.rgb_intensity,g.rgb[2]*g.rgb_intensity];e.values[c]=a;b.callback&&b.callback.call(h,a.concat(),"#"+g.toString(),g);$(h).trigger("wchange",[a.concat(),g.toString()]);if(e.onchange)e.onchange(c,a.concat(),h)};b.step=
b.step||0.01;b.dragger_class="nano";a=new LiteDragger(1,b);$(h).find(".wcontent").append(a.root);$(a.input).change(function(){var a=parseFloat($(this).val());g.rgb_intensity=a;if(g.onImmediateChange)g.onImmediateChange()});return h};
Inspector.prototype.addFile=function(c,a,b){b=b||{};a=a||"";var e=this;this.values[c]=a;var d=this.createWidget(c,"<span class='inputfield full whidden'><span class='filename'>"+a+"</span><input type='file' size='100' class='file' value='"+a+"'/></span>",b);$(d).find(".wcontent input").change(function(a){b.callback&&b.callback.call(d,a.target.value);$(d).find(".filename").html(a.target.value);$(d).trigger("wchange",[a.target.files]);Inspector.onWidgetChange.call(e,d,c,a.target.value,b)});this.append(d);
return d};Inspector.prototype.addLine=function(c,a,b){b=b||{};a=a||"";var e=this;this.values[c]=a;var d=this.createWidget(c,"<span class='line-editor'></span>",b);a=new LiteLineEditor(a,b);$(d).find("span.line-editor").append(a);$(a).change(function(a){b.callback&&b.callback.call(d,a.target.value);$(d).trigger("wchange",[a.target.value]);Inspector.onWidgetChange.call(e,d,c,a.target.value,b)});this.append(d);return d};
Inspector.prototype.addTree=function(c,a,b){function e(a,b){for(var c in b){var n=document.createElement("div");n.className="treenode";"object"==typeof b[c]?(n.innerHTML="<span class='itemname'>"+c+"</span><span class='itemcontent'></span>",e($(n).find(".itemcontent")[0],b[c])):n.innerHTML="<span class='itemname'>"+c+"</span><span class='itemvalue'>"+b[c]+"</span>";a.appendChild(n)}}b=b||{};a=a||"";c=this.createWidget(c,"<div class='wtree'></div>",b);b=$(c).find(".wtree")[0];e(b,a);this.append(c);
return c};Inspector.parseColor=function(c){return"<span style='color: #FAA'>"+c[0].toFixed(2)+"</span>,<span style='color: #AFA'>"+c[1].toFixed(2)+"</span>,<span style='color: #AAF'>"+c[2].toFixed(2)+"</span>"};
function LiteDragger(c,a){function b(b){var c=[b.screenX-f.data[0],f.data[1]-b.screenY];f.data=[b.screenX,b.screenY];d(c[a.horizontal?0:1],b);b.stopPropagation();b.preventDefault();return!1}function e(a){$(f).trigger("stop_dragging");$(document).unbind("mousemove",b);$(document).unbind("mouseup",e);$(f).trigger("blur");a.stopPropagation();a.preventDefault();return!1}function d(b,c){var d=a.step?a.step:1;c&&c.shiftKey?d*=10:c&&c.ctrlKey&&(d*=0.1);d=parseFloat(q.value)+b*d;null!=a.max&&d>a.max&&(d=
a.max);null!=a.min&&d<a.min&&(d=a.min);q.value=a.precision?d.toFixed(a.precision):(1E3*d<<0)/1E3;a.units&&(q.value+=a.units);$(q).change()}a=a||{};var h=document.createElement("div");h.className="dragger "+(a.extraclass?a.extraclass:"");var g=document.createElement("span");g.className="inputfield "+(a.extraclass?a.extraclass:"");a.disabled&&(g.className+=" disabled");h.appendChild(g);var n=a.dragger_class||"full",q=document.createElement("input");q.className="text number "+(n?n:"");q.value=c+(a.units?
a.units:"");q.tabIndex=a.tab_index;this.input=q;$(q).bind("keydown",function(a){if(38==a.keyCode)d(1,a);else if(40==a.keyCode)d(-1,a);else return;a.stopPropagation();a.preventDefault();return!0});a.disabled&&(q.disabled=!0);a.tab_index&&(q.tabIndex=a.tab_index);g.appendChild(q);h.input=q;var f=document.createElement("div");f.className="drag_widget";a.disabled&&(f.className+=" disabled");g.appendChild(f);h.dragger=f;this.root=h;$(f).bind("mousedown",function(c){a.disabled||($(document).bind("mousemove",
b),$(document).bind("mouseup",e),f.data=[c.screenX,c.screenY],$(f).trigger("start_dragging"));c.stopPropagation();c.preventDefault()})}
function LiteLineEditor(c,a){function b(a){return[p.width*((f.xrange[1]-f.xrange[0])*a[0]+f.xrange[0]),p.height*((f.yrange[1]-f.yrange[0])*a[1]+f.yrange[0])]}function e(a){return[(a[0]/p.width-f.xrange[0])/(f.xrange[1]-f.xrange[0]),(a[1]/p.height-f.yrange[0])/(f.yrange[1]-f.yrange[0])]}function d(a){var b=p.getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;0>c?c=0:c>p.width&&(c=p.width);0>d?d=0:d>p.height&&(d=p.height);if(-1!=k&&n([a.clientX-b.left,a.clientY-b.top],[c,d])>0.5*p.height)f.value.splice(k,
1),h(a);else{b=e([-(l[0]-c),l[1]-d]);if(-1!=k){var s=f.xrange[0],u=f.xrange[1];f.no_trespassing&&(0<k&&(s=f.value[k-1][0]),k<f.value.length-1&&(u=f.value[k+1][0]));var r=f.value[k];r[0]+=b[0];r[1]+=b[1];r[0]<s?r[0]=s:r[0]>u&&(r[0]=u);r[1]<f.yrange[0]?r[1]=f.yrange[0]:r[1]>f.yrange[1]&&(r[1]=f.yrange[1])}q();f.redraw();l[0]=c;l[1]=d;g();a.preventDefault();a.stopPropagation()}}function h(a){k=-1;f.redraw();$(document).unbind("mousemove",d);$(document).unbind("mouseup",h);g();a.preventDefault();a.stopPropagation()}
function g(){a.callback?a.callback.call(f,f.value):$(f).change()}function n(a,b){return Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2))}function q(){var a=null;-1!=k&&(a=f.value[k]);f.value.sort(function(a,b){return a[0]>b[0]});a&&(k=f.value.indexOf(a))}a=a||{};var f=document.createElement("div");f.className="curve "+(a.extraclass?a.extraclass:"");f.style.minHeight="50px";f.style.width=a.width||"100%";f.bgcolor=a.bgcolor||"#222";f.pointscolor=a.pointscolor||"#5AF";f.linecolor=a.linecolor||
"#444";f.value=c||[];f.xrange=a.xrange||[0,1];f.yrange=a.yrange||[0,1];f.defaulty=null!=a.defaulty?a.defaulty:0.5;f.no_trespassing=a.no_trespassing||!1;f.show_samples=a.show_samples||0;f.options=a;var p=document.createElement("canvas");p.width=a.width||200;p.height=a.height||50;f.appendChild(p);f.canvas=p;$(p).bind("mousedown",function(a){$(document).bind("mousemove",d);$(document).bind("mouseup",h);for(var c=p.getBoundingClientRect(),g=a.clientX-c.left,c=a.clientY-c.top,t=p.height-c,s=1E5,u=-1,r=
0;r<f.value.length;r++){var x=b(f.value[r]),x=n([g,t],x);x<s&&8>x&&(s=x,u=r)}k=u;-1==k&&(t=e([g,p.height-c]),f.value.push(t),q(),k=f.value.indexOf(t));l=[g,c];f.redraw();a.preventDefault();a.stopPropagation()});$(f).resize(function(a){p.width=$(this).width();p.height=$(this).height();f.redraw()});f.getValueAt=function(a){if(a<f.xrange[0]||a>f.xrange[1])return f.defaulty;for(var b=[f.xrange[0],f.defaulty],c=0,c=0;c<f.value.length;c+=1){var d=f.value[c];if(a==d[0])return d[1];if(a<d[0])return c=(a-
b[0])/(d[0]-b[0]),b[1]*(1-c)+d[1]*c;b=d}d=[f.xrange[1],f.defaulty];c=(a-b[0])/(d[0]-b[0]);return b[1]*(1-c)+d[1]*c};f.resample=function(a){var b=[];a=(f.xrange[1]-f.xrange[0])/a;for(var c=f.xrange[0];c<=f.xrange[1];c+=a)b.push(f.getValueAt(c));return b};f.addValue=function(a){for(var b=0;b<f.value;b++)if(!(f.value[b][0]<a[0])){f.value.splice(b,0,a);redraw();return}f.value.push(a);redraw()};var k=-1;f.redraw=function(){var a=p.getContext("2d");a.setTransform(1,0,0,1,0,0);a.translate(0,p.height);a.scale(1,
-1);a.fillStyle=f.bgcolor;a.fillRect(0,0,p.width,p.height);a.strokeStyle=f.linecolor;a.beginPath();var c=b([f.xrange[0],f.defaulty]);a.moveTo(c[0],c[1]);for(var d in f.value)c=f.value[d],c=b(c),a.lineTo(c[0],c[1]);c=b([f.xrange[1],f.defaulty]);a.lineTo(c[0],c[1]);a.stroke();for(d=0;d<f.value.length;d+=1)c=f.value[d],c=b(c),a.fillStyle=k==d?"white":f.pointscolor,a.beginPath(),a.arc(c[0],c[1],k==d?4:2,0,2*Math.PI),a.fill();if(f.show_samples){var e=f.resample(f.show_samples);a.fillStyle="#888";for(d=
0;d<e.length;d+=1)c=[d*((f.xrange[1]-f.xrange[0])/f.show_samples)+f.xrange[0],e[d]],c=b(c),a.beginPath(),a.arc(c[0],c[1],2,0,2*Math.PI),a.fill()}};var l=[0,0];f.redraw();return f}LiteGUI.Inspector=Inspector;
